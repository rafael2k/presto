<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
          "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<link rel=stylesheet href="../../coredoc/coredoc.css" />
<title>Module: Formats</title>
</head>

<body>

<h1>Module: Formats</h1>

<h2>About this module</h2>

The Formats module encodes and decodes several formats to and from internal representation, including

<UL>
<li> Base64
<li> Quoted Printable
<li> Parameter syntax from MIME and HTML headers, including RFC 2231 style encoding
<li> Parsing of MIME/HTTP headers
</UL>

The internal formats for parameters and headers include enumerations of often used names.

<p>
Supported protocols:
<p>
<UL>
<li> <a href="http://www.ietf.org/rfc/rfc2616.txt">HTTP 1.1</a>
<li> <a href="http://wp.netscape.com/newsref/std/cookie_spec.html">Netscape Cookies</a>
<li> <a href="http://www.ietf.org/rfc/rfc2965.txt">RFC 2965</a>
<li> <a href="http://www.ietf.org/rfc/rfc2045.txt">MIME 1</a> <a href="http://www.ietf.org/rfc/rfc2046.txt">2</a>  <a href="http://www.ietf.org/rfc/rfc2047.txt">3</a> <a href="http://www.ietf.org/rfc/rfc2048.txt">4</a>   <a href="http://www.ietf.org/rfc/rfc2049.txt">5</a>
<li> <a href="http://www.ietf.org/rfc/rfc2231.txt">RFC 2231</a> 
</UL>


<h2>Interface overview and API documentation</h2>

<p><a href="api/index.html">API documentation generated by
Doxygen</a> contains all necessary information for the external APIs.</p>
<h3>An overview of the module's implementation</h3>

<p>The module contains a collection of utility functions handling the formats used in http header handling, 
	cookies and encoding. Collections of key-value pairs are created or data encoded/decoded. Calling functions
	are responsible for memory management of the objects.</p>
	
<p>The Sequence splitter creates lists of objects that may either contain allocated strings or reference an externally 
managed string. The sequence can be initialized based on one of several profiles specifying how each key/value
pair is separated from each other, and how the parts of the pair are separated. The splitteer can process several kinds of data, in particular RFC2231 encoded values, when requested to.</p>

<p>The list of objects are searchable on the name field, either by name or by an associated enumerated value.</p>

<p>The encoders are used to create a binary string in binary, Qouted-Printable or Base64 format. There is also a decoder for base64.</p>

<p>The DataFile and Record classes are base on DataStream classes to read and write the format used by the cache and cookie index files, as well as the storage file of several other modules.</p>

<h3>Footprint</h3>

<p>The module is of moderate size. Various features can be enabled or disabled, either thorugh feature defines or specific defines.</p>

<h3>Dynamic memory use and OOM handling</h3>

<dl>
<dt>OOM policies
<dd><p>Most of internal module functions handles OOM by LEAVing, and the caller must TRAP errors and handle them. </p>

<dt>Who handles OOM?
<dd>In the case of LEAVE functions the caller must TRAP the errors, and handle the OOM situations.

<dt>Flow
<dd><p>The module is client push based, the caller request an action and gets aresult.</p>

<dt>Heap memory usage
<dd>
<p> Sequence splitters are usually not kept for long, and their allocated size depends on the number of elements and actual bodysize.</p>

<p> The encoders allocate memory that must be freed by the caller.

<dt>Stack memory usage
<dd><p>Usually large objects are allocated </p>

<p>In most cases stack consumption should be less than 300 bytes.</p>

<dt>Static memory usage
<dd><p>A number of compiled const arrays exists.</p>

<dt>Caching and freeing memory
<dd><p>No caching is performed. Caller must manage the objects</p>

<dt>Freeing memory on exit
<dd><p>Const arrays in pseudo const mode are deleted on exit</p>

<dt>Temp buffers
<dd><p>No shared temp buffers are used.</p>

<dt>Memory tuning
<dd><p>At present there are no opportunities to tune memory use.</p>

<dt>Tests
<dd><p>Selftests, but they do not check memory usage.</p>

<dt>Coverage
<dd><p>Selftests, ordinary surfing, reading email.</p>

<dt>Design choices
<dd><p>The sequence splitter will use a single string and chop it into pieces handed to each sub element. This reduces memory consumption and allocation overhead.</p>

<dt>Improvements
<dd><p>There are currently no planned improvements.</p>



</dl>
