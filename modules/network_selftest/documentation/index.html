<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
          "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<link rel=stylesheet href="../../coredoc/coredoc.css" />
<title>Module: Network_selftest</title>
</head>

<body>

<h1>Module: Network_selftest</h1>

<h2>About this module</h2>

<p>The Network_selftest provides utility functions for the network module selftests, allowing batch URL loading and result comparisons, and User Interface simulation.</p>

<p>These utility functions were previously spread across the url, libssl and mime modules.</p>

<h2>Interface overview and API documentation</h2>

<p><a href="api/index.html">API documentation generated by
Doxygen</a> contains all necessary information for the external APIs.</p>

<h3>API Overview: Basic testsystem</h3>
	<dl>
		<dt>URL_DocSelfTest_Manager
		<dd><p>Master class for managing batches (URL_DocSelfTest_Batch) of tests. 
			This object owns all the batches added through AddBatch(). Testing 
			of the batches, in the sequence added, starts when SetLastBatch() 
			is called.</p>
			
			<p>Selftest code must construct this object, then allocate and add 
			batches and finally call SetLastBatch() in an async test.</p>

		<dt>URL_DocSelfTest_Batch
		<dd><p>Manages a group of testcases (URL_DocSelfTest_Item). This object
			owns all the testcases added through AddTestCase(). Loading is 
			initiated by URL_DocSelfTest_Manager. All testcases in a batch are 
			loaded in parallel.</p>
			
			<P>Selftest code must allocate an object of this class, allocate and 
			add testcases, before releasing it to the manager using Addbatch().</P>
			
		<dt>URL_DocSelfTest_Item
		<dd><P>Base class for testitems. Based on URL_DocumentHandler. Should not be 
			used directly as it only organizes the loading, does not perform any 
			tests; those have to be implemented in subclasses. Loading is initiated 
			by URL_DocSelfTest_Batch.</P>
			
			<P>Selftest code must allocate and construct implementations of this class 
			and add them to the batch using AddTestCase().</P>
			
		<dt>URL_DocSimpleTester/URL_DocVerySimpleTest
		<dd><P>Simple testcase that loads a resource and compares it to a local file.</P>
			
		<dt>ServerPush_DocTester/ServerPush_DocBlockedTester
		<dd><P>Tests a multipart/x-mixed-replace stream, comparing it to local files.</P>
			
		<dt>ScanPass_SimpleTester/UniScanPass_SimpleTester
		<dd><P>Load the specified text resource, then scan the content for the expected 
			pass string.</P>
			
		<dt>Security_Level_Tester
		<dd><P>Load a resource and check if it at least matches the specified security level.</P>
			
		<dt>MatchWithURL_Tester
		<dd><P>Loads two resources, then compares them to check if they match at the binary level.</P>
			
		<dt>JustLoad_Tester
		<dd><P>Loads a URL, passes if the loading succeeds.</P>
	</dl>
	
	<h3>API Overview: Advanced remote configurable testsystem</h3>
	
	<P>This system is based on XML configuration files hosted on a remote server.</P>
	
	<dl>
		<dt>RemoteFrameworkManager
		<dd><P>The manager of the tests. An async test uses an object of this class to
			add URLs for the specifications using the AddTestSuite() function.</P>
			
			<P>Internally two classes RemoteFrameworkMaster and RemoteFrameworkTestSuites 
			processes the XML files and constructs testcases using the above 
			mentioned testclasses.</P>
			
			Fileformat is documented in <a href="framework-format.html">framework-format.html</a>
	</dl>

	<h3>API Overview: Helper classes</h3>
	
	
	<dl>
		<dt>SSL_WaitForAutoUpdate/SSL_WaitForPendingAutoUpdate
		<dd><P>These can be used by an async testcase to wait for SSL autoupdates. Times out after one minute.</P>

		<dt>BasicWindowListener
		<dd><P>Implementations can create to override triggered dialog actions. This class connects 
			the implementations to the testmanager. Default action is to use the pre-existing 
			loading listener (which MUST be non-NULL) or the NullLoadingListener implementation.</P>

		<dt>BasicSSLWindowListener
		<dd><P>Similar to BasicWindowListener, but for the SSL listener. This class connects 
			the implementations to the testmanager. Default action is to use the pre-existing 
			ssl listener (which MUST be non-NULL) or the NullSSLListener implementation.</P>

		<dt>Selftest_ProxyOveride
		<dd><P>Overrides the proxy preferences during a selftest.</P>
	</dl>
	

<h2>Implementation description</h2>

<p><a href="all/index.html">API documentation generated by
Doxygen</a> contains information about the internal organization of the module.</p>

<h3>Footprint</h3>

<p>The module is very small, and the code is only enabled for selftest builds, not production releases</p>

<h3>Dynamic memory use and OOM handling</h3>

<dl>
<dt>OOM policies
<dd><p>All the functions handle OOM by returning a status to the caller. Such errors will usually result in the test reporting failure.</p>

<dt>Who handles OOM?
<dd><p>There is no particular OOM handling. A failure code is returned to the caller, which is expected to exit with a failure code of its own.</p>

<dt>Flow
<dd><p>Part of the classes emulate UI listeners, and act based on callbacks.</p>
	
<p>Other classes are batch load managers that are configured by callers, then activated. After activation these classes are message driven and will perfrom various operations upon receipt of these messages.</p>

<dt>Heap memory usage
<dd> <p>Most data are stored in URLs, but the UI emulators may store a few strings. Processing steps can temprarily allocate buffers and other objects</p>

<dt>Stack memory usage
<dd><p>Usually large objects are allocated on the heap. In some cases sizeable objects are placed on the stack but only for shorter periods. </>

<p>In most cases stack consumption should be less than 300 bytes.</>

<dt>Static memory usage
<dd><p>The module does not use any persistent storage. All longlived storage is managed by the caller, and freed by the caller, or by URLs.</p>


<dt>Caching and freeing memory
<dd><p>All longlived data storage is maintained by the URL contained in some classes.</p>

<dt>Freeing memory on exit
<dd><p>The code using these utilities are resposible for freeing all objects of these utilities they have allocated.</p>

<dt>Temp buffers
<dd><p>Some code uses a memory manager temporary buffer for some internal operations. These operations are fairly independent, and will not cause collisions with other users of the buffer.</p>

<dt>Memory tuning
<dd><p>At present there are no opportunities to tune memory use.</p>

<dt>Tests
<dd><p>None. The classes are used directly and only by selftests. Selftests are not relevant as any test would have to duplicate testcases in other modules.</p>

<dt>Coverage
<dd><p>None. The classes are used directly and only by selftests. Coverage is not relevant.</p>

<dt>Design choices
<dd><p>The batch loaded classes are designed to perform various tests by loading URLs and comparing the result with some expected content, either by direct string comparison, or by comparing against a file.</p>

<p>The UI emulators are basic wrappers around the pre-exisiting listeners. Actual implementations will be based on these classes.</p>

<dt>Improvements
<dd><p>At present, no improvments are planned.</p>

</dl>

</body>
</html>
