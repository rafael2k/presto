/* -*- mode: c++; tab-width: 4; c-basic-offset: 4 -*- */

group "layout.generated-content";

require init;

include "modules/doc/frm_doc.h";
include "modules/layout/box/box.h";
include "modules/layout/content/content.h";
include "modules/logdoc/htm_elm.h";
include "modules/url/url_api.h";

language c++;

global
{
#define num_cows 15
	URL cow_svg_url[num_cows];
}

setup
{
	for (int i=0; i<num_cows; i++)
	{
		OpString8 url;
		OpStatus::Ignore(url.AppendFormat("opera:selftest_layout_generated-content_cow%02d.svg", i));
		cow_svg_url[i] = g_url_api->GetURL(url.CStr());
		cow_svg_url[i].ForceStatus(URL_LOADING);
		OpStatus::Ignore(cow_svg_url[i].SetAttribute(URL::KMIME_ForceContentType, "image/svg+xml"));
		OpStatus::Ignore(cow_svg_url[i].SetAttribute(URL::KMIME_CharSet, "utf-16"));

		uni_char temp = 0xfeff; // unicode byte order mark
		cow_svg_url[i].WriteDocumentData(URL::KNormal, &temp, 1);

		cow_svg_url[i].WriteDocumentData(URL::KNormal, UNI_L("<svg viewBox=\"-2 -2 227 256\" width=\"100\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" id=\"svg2\">\n  <g transform=\"translate(-238.92378,-428.4017)\" id=\"layer1\">\n    <path d=\"M 441,560 C 441,610 401,650 351,650 C 301,650 261,610 261,560 C 261,510 301,470 351,470 C 401,470 441,510 441,560 z\" transform=\"matrix(1.2167832,0,0,1.2167832,-76.150099,-121.55162)\" id=\"path2383\" style=\"opacity:1;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:3.28735638;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 441,500 C 435,507 434,517 436,521 C 437,524 446,526 453,527 C 450,517 446,508 441,500 z M 247,530 C 244,539 243,550 243,560 C 243,566 243,571 244,577 C 252,581 263,597 272,598 C 283,600 281,577 274,575 C 267,574 264,563 263,551 C 263,543 259,535 247,530 z M 459,557 C 456,559 453,561 451,564 C 439,579 429,569 417,574 C 405,580 413,593 418,607 C 421,616 415,635 422,641 C 445,622 459,593 459,560 C 459,559 459,558 459,557 C 459,557 459,557 459,557 z M 312,567 C 317,582 306,577 304,587 C 302,597 337,600 343,621 C 349,643 375,631 375,619 C 374,608 357,602 362,595 C 366,588 375,574 375,574 L 312,567 z\" id=\"path3173\" style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"/>\n    <path d=\"M 454,523 C 454,524 454,526 454,528 C 454,588 405,637 344,637 C 297,637 257,607 241,565 C 244,623 292,670 351,670 C 411,670 460,621 460,560 C 460,547 458,534 454,523 z\" id=\"path3221\" style=\"opacity:1;fill:#000000;fill-opacity:0.31372549;fill-rule:nonzero;stroke:none;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 359,671 C 359,680 374,680 392,680 C 410,680 424,681 424,671 C 424,653 410,639 392,639 C 374,639 359,653 359,671 z\" id=\"path3172\" style=\"fill:#333333;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:3.99999976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1\"/>\n    <path d=\"M 435,525 C 435,570 380,607 354,607 C 328,607 272,570 272,525 C 272,480 296,443 354,443 C 411,443 435,480 435,525 z\" id=\"path3236\" style=\"fill:#000000;fill-opacity:0.31372549;fill-rule:nonzero;stroke:none;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1\"/>\n    <path d=\"M 404,680 C 404,663 395,653 395,653 C 395,653 399,667 398,680 L 404,680 z\" id=\"path3174\" style=\"fill:#000000;fill-opacity:0.31372549;fill-rule:evenodd;stroke:#000000;stroke-width:4;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 108,46 C 78,46 57,57 45,75 C 21,72 1,98 1,98 C 1,98 20,108 33,100 C 30,108 29,118 29,128 C 29,173 85,210 111,210 C 138,210 193,173 193,128 C 193,118 192,108 189,100 C 202,108 221,98 221,98 C 221,98 201,72 177,75 C 164,57 143,46 111,46 C 110,46 109,46 108,46 z\" transform=\"translate(239.73628,384.06586)\" id=\"path3155\" style=\"fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1\"/>\n    <path d=\"M 365,432 C 391,450 362,449 356,455 C 350,462 347,472 355,479 C 362,485 401,496 406,478 C 409,469 406,457 404,447 C 394,439 381,434 365,432 z\" id=\"path3185\" style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"/>\n    <path d=\"M 441,560 C 441,610 401,650 351,650 C 301,650 261,610 261,560 C 261,510 301,470 351,470 C 401,470 441,510 441,560 z\" transform=\"matrix(0.2517482,0,0,0.2517482,236.54837,359.07889)\" id=\"path3157\" style=\"opacity:1;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:15.88889027;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 441,560 C 441,610 401,650 351,650 C 301,650 261,610 261,560 C 261,510 301,470 351,470 C 401,470 441,510 441,560 z\" transform=\"matrix(0.2517482,0,0,0.2517482,289.28057,359.07889)\" id=\"path3159\" style=\"opacity:1;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:15.88889027;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 441,560 C 441,610 401,650 351,650 C 301,650 261,610 261,560 C 261,510 301,470 351,470 C 401,470 441,510 441,560 z\" transform=\"matrix(8.3916033e-2,0,0,8.3916033e-2,343.19932,457.18337)\" id=\"path3161\" style=\"opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:47.66669083;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 441,560 C 441,610 401,650 351,650 C 301,650 261,610 261,560 C 261,510 301,470 351,470 C 401,470 441,510 441,560 z\" transform=\"matrix(8.3916033e-2,0,0,8.3916033e-2,301.16898,457.18337)\" id=\"path3163\" style=\"opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:47.66669083;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 111,159 C 91,159 75,172 75,189 C 75,192 76,195 77,197 C 89,205 102,210 111,210 C 120,210 133,205 145,198 C 146,195 147,192 147,189 C 147,172 131,159 111,159 z\" transform=\"translate(239.73628,384.06586)\" id=\"path3210\" style=\"opacity:1;fill:#ffd5e5;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 190,101 L 188,104 C 188,107 188,110 188,113 C 188,158 133,195 106,195 C 86,195 45,171 30,138 C 38,178 87,210 111,210 C 138,210 193,173 193,128 C 193,118 192,109 190,101 z\" transform=\"translate(239.73628,384.06586)\" id=\"path3231\" style=\"fill:#000000;fill-opacity:0.31372549;fill-rule:nonzero;stroke:none;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1\"/>\n    <path d=\"M 344,671 C 344,680 329,680 311,680 C 293,680 278,681 278,671 C 278,653 293,639 311,639 C 329,639 344,653 344,671 z\" id=\"path3329\" style=\"fill:#333333;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:3.99999976;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1\"/>\n    <path d=\"M 299,680 C 299,663 308,653 308,653 C 308,653 304,667 305,680 L 299,680 z\" id=\"path3331\" style=\"fill:#000000;fill-opacity:0.31372549;fill-rule:evenodd;stroke:#000000;stroke-width:4;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 367,568 C 365,572 361,574 358,573 C 355,571 355,566 357,562 C 359,558 363,556 366,558 C 369,560 370,564 367,568 z\" id=\"path2398\" style=\"opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:47.66669083;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 335,568 C 337,572 341,574 344,573 C 347,571 347,566 345,562 C 343,558 339,556 336,558 C 333,560 332,564 335,568 z\" id=\"path2412\" style=\"opacity:1;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:47.66669083;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 292,460 C 284,459 276,439 279,435 C 282,431 306,439 306,448 C 307,456 301,462 292,460 z\" id=\"path2399\" style=\"fill:#333333;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n    <path d=\"M 409,460 C 416,459 424,439 421,435 C 418,431 395,439 394,448 C 394,456 400,462 409,460 z\" id=\"path3171\" style=\"fill:#333333;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"/>\n  </g>\n</svg>"));
	}
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("basic ::before")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	verify(!before_pseudo->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("basic ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	verify(!after_pseudo->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("basic ::before and ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	verify(after_pseudo->Pred() == before_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(!before_pseudo->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	verify(after_pseudo->Pred());
	verify(after_pseudo->Pred()->GetLayoutBox());
	verify(after_pseudo->Pred()->GetLayoutBox()->IsTextBox());
	verify(!after_pseudo->Pred()->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before and text and ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(before_pseudo->Suc()->Suc() == after_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::before image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	verify(!before_pseudo->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::after image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	verify(!after_pseudo->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::before image and ::after image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	verify(after_pseudo->Pred() == before_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before image and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(!before_pseudo->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	verify(after_pseudo->Pred());
	verify(after_pseudo->Pred()->GetLayoutBox());
	verify(after_pseudo->Pred()->GetLayoutBox()->IsTextBox());
	verify(!after_pseudo->Pred()->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before image and text and ::after image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(before_pseudo->Suc()->Suc() == after_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(!text->GetLayoutBox());

	HTML_Element* image = text->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
	verify(!image->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::before { content:inherit; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before{content:inherit} and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(!text->GetLayoutBox());

	HTML_Element* image = text->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
	verify(!image->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::after { content:inherit; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with content:image and ::after{content:inherit}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(!text->GetLayoutBox());

	HTML_Element* image = text->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::before, #elm::after { content:inherit; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before,::after{content:inherit} and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(!text->GetLayoutBox());

	HTML_Element* image = text->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(opera:selftest_layout_generated-content_cow00.svg); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::before SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->GetContent());
	verify(before_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(!before_pseudo->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:url(opera:selftest_layout_generated-content_cow01.svg); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::after SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->GetContent());
	verify(after_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(!after_pseudo->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(opera:selftest_layout_generated-content_cow02.svg); }
	//!  #elm::after { content:url(opera:selftest_layout_generated-content_cow03.svg); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("DIV with ::before SVG and ::after SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->GetContent());
	verify(before_content->GetLayoutBox()->GetContent()->IsIFrame());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->GetContent());
	verify(after_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(after_pseudo->Pred() == before_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(opera:selftest_layout_generated-content_cow04.svg); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before SVG and text")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->GetContent());
	verify(before_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(!before_pseudo->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:url(opera:selftest_layout_generated-content_cow05.svg); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->GetContent());
	verify(after_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(after_pseudo->Pred());
	verify(after_pseudo->Pred()->GetLayoutBox());
	verify(after_pseudo->Pred()->GetLayoutBox()->IsTextBox());
	verify(!after_pseudo->Pred()->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:url(opera:selftest_layout_generated-content_cow06.svg); }
	//!  #elm::after { content:url(opera:selftest_layout_generated-content_cow07.svg); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before SVG and text and ::after SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->GetContent());
	verify(before_content->GetLayoutBox()->GetContent()->IsIFrame());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->GetContent());
	verify(after_content->GetLayoutBox()->GetContent()->IsIFrame());

	verify(before_pseudo->Suc());
	verify(before_pseudo->Suc()->GetLayoutBox());
	verify(before_pseudo->Suc()->GetLayoutBox()->IsTextBox());
	verify(before_pseudo->Suc()->Suc() == after_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(opera:selftest_layout_generated-content_cow08.svg); }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with content:SVG")
require SVG_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(!text->GetLayoutBox());

	HTML_Element* svg = text->Suc();
	verify(svg);
	verify(svg->GetLayoutBox());
	verify(svg->GetLayoutBox()->GetContent());
	verify(svg->GetLayoutBox()->GetContent()->IsIFrame());

	verify(!svg->FirstChild());
	verify(!svg->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-cell; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before{display:table-cell} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Suc());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-cell; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after{display:table-cell}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = after_pseudo->Pred();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Pred());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before,::after{display:table-cell} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before{display:table-row} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Suc());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after{display:table-row}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = after_pseudo->Pred();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Pred());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before,::after{display:table-row} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row-group; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before{display:table-row-group} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Suc());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row-group; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after{display:table-row-group}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = after_pseudo->Pred();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Pred());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row-group; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before,::after{display:table-row-group} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before{display:table} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Suc());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with text and ::after{display:table}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = after_pseudo->Pred();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Pred());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before,#elm::after { display:table; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with ::before,::after{display:table} and text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-cell; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with display:table-cell and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableCell());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(text->Type() == Markup::HTE_TEXT);
	verify(!text->GetLayoutBox());

	HTML_Element* content = text->Suc();
	verify(content);
	verify(!content->FirstChild());
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());
	verify(!content->Suc());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with display:table-row and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(text->Type() == Markup::HTE_TEXT);
	verify(!text->GetLayoutBox());

	HTML_Element* content = text->Suc();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row-group; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with display:table-row-group and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(text->Type() == Markup::HTE_TEXT);
	verify(!text->GetLayoutBox());

	HTML_Element* content = text->Suc();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table; content:"x"; }
	//! </style></head><body>
	//!  <div id="elm">y</div>
	//! </body></html>
}
test("DIV with display:table and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetTableContent());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(text->Type() == Markup::HTE_TEXT);
	verify(!text->GetLayoutBox());

	HTML_Element* content = text->Suc();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRowGroup());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	verify(elm->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("::before does not apply to replaced elements")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineBox());
	verify(elm->GetLayoutBox()->IsContentReplaced());
	verify(((ReplacedContent*) elm->GetLayoutBox()->GetContent())->IsForm());
	verify(!elm->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("::after does not apply to replaced elements")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsContentReplaced());
	verify(((ReplacedContent*) elm->GetLayoutBox()->GetContent())->IsForm());
	verify(!elm->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before and text and ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsContentReplaced());
	verify(((ReplacedContent*) elm->GetLayoutBox()->GetContent())->IsForm());
	verify(!elm->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* image = elm->FirstChild();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
	verify(!image->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::before { content:inherit; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before{content:inherit} and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* image = before_pseudo->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
	verify(!image->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::after { content:inherit; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ content:image and ::after{content:inherit}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	HTML_Element* image = elm->FirstChild();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm::before, #elm::after { content:inherit; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{content:inherit} and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());

	HTML_Element* image = before_pseudo->Suc();
	verify(image);
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->FirstChild());
	verify(image->Suc() == after_pseudo);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:"x"; }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table-cell} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:"x"; }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table-cell} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row; content:"x"; }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table-row} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row; content:"x"; }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table-row} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row-group; content:"x"; }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TRG} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row-group; content:"x"; }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TRG} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before,#elm::after { display:table; content:"x"; }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before,#elm::after { display:table; content:"x"; }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TC,img} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TC,img} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableCell());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TR,img} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TR,img} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRow());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row-group; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TRG,img} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before, #elm::after { display:table-row-group; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:TRG,img} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	before_pseudo = before_pseudo->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	after_pseudo = after_pseudo->FirstChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before,#elm::after { display:table; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table,img} and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* text = before_pseudo->Suc();
	verify(text);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(text->Suc() == after_pseudo);

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before,#elm::after { display:table; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//!  #elm { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ ::before,::after{display:table,img} and content:img")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsBlockBox());
	verify(before_pseudo->GetLayoutBox()->GetTableContent());

	HTML_Element* img = before_pseudo->Suc();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRowGroup());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableRow());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTableCell());

	before_content = before_content->FirstChild();
	verify(before_content);
	verify(!before_content->Suc());
	verify(!before_content->FirstChild());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsContentImage());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsBlockBox());
	verify(after_pseudo->GetLayoutBox()->GetTableContent());

	verify(img->Suc() == after_pseudo);

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRowGroup());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableRow());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTableCell());

	after_content = after_content->FirstChild();
	verify(after_content);
	verify(!after_content->Suc());
	verify(!after_content->FirstChild());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-cell; content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-cell and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableCell());

	HTML_Element* text = elm->FirstChild();
	verify(text);
	verify(text->Type() == Markup::HTE_TEXT);
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());
	verify(!text->Suc());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row; content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-row and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row-group; content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-row-group and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table; content:"x"; }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table and content:")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetTableContent());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRowGroup());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTextBox());

	verify(elm->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-cell; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-cell and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableCell());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->Type() == Markup::HTE_IMG);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsContentImage());
	verify(!content->Suc());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-row and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsContentImage());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table-row-group; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table-row-group and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsContentImage());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox());
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm { display:table; content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <input id="elm">
	//! </body></html>
}
test("INPUT w/ display:table and content:image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetTableContent());

	HTML_Element* content = elm->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRowGroup());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableRow());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsTableCell());

	content = content->FirstChild();
	verify(content);
	verify(content->GetLayoutBox());
	verify(content->GetLayoutBox()->IsContentImage());

	verify(elm->Parent()->Type() == Markup::HTE_BODY);
}

language ecmascript;

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div style="content:none;">HEST</div>
	//!  </div>
	//! </body></html>
}
test("content:none")
{
	verify(document.getElementById('elm').offsetWidth == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div style="content:normal;">HEST</div>
	//!  </div>
	//!  <div style="float:left;" id="ref">HEST</div>
	//! </body></html>
}
test("content:normal")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left; content:normal;" id="elm">
	//!   <div>HEST</div>
	//!  </div>
	//!  <div style="float:left;" id="ref">HEST</div>
	//! </body></html>
}
test("content:normal on parent")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div style="content:inherit;">HEST</div>
	//!  </div>
	//!  <div style="float:left;" id="ref">HEST</div>
	//! </body></html>
}
test("content:inherit")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left; content:normal;" id="elm">
	//!   <div style="content:inherit;">HEST</div>
	//!  </div>
	//!  <div style="float:left;" id="ref">HEST</div>
	//! </body></html>
}
test("content:inherit content:normal")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div attr="value" style="content:attr(attr);"></div>
	//!  </div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr()")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div attr="value" style="display:table-cell; content:attr(attr);"></div>
	//!  </div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div attr="value" style="display:table-row; content:attr(attr);"></div>
	//!  </div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div attr="value" style="display:table-row-group; content:attr(attr);"></div>
	//!  </div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div style="float:left;" id="elm">
	//!   <div attr="value" style="display:table; content:attr(attr);"></div>
	//!  </div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-cell;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-cell::before")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-row::before")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row-group;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table-row-group::before")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on table::before")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-cell; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row-group; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="float:left;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-cell; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-cell;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-cell in table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-cell;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-row in table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row-group; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-cell;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-row-group in table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-cell;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table in table-cell")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-cell; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-cell in table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row in table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row-group; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row-group in table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table in table-row")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-cell; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row-group;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-cell in table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row-group;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-row in table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table-row-group; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row-group;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table-row-group in table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { display:table; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table-row-group;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::before with table in table-row-group")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-cell; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-cell in table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row in table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table-row-group; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table-row-group in table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::after { display:table; content:attr(attr); }
	//! </style></head><body>
	//!  <div style="display:table;" id="elm" attr="value"></div>
	//!  <div style="float:left;" id="ref">value</div>
	//! </body></html>
}
test("attr() on ::after with table in table")
{
	verify(document.getElementById('elm').offsetWidth == document.getElementById('ref').offsetWidth);
}

language C++;

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="content:-o-skin('Smiley Happy')"></div>
	//! </body></html>
}
test("-o-skin")
require SKIN_SUPPORT;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* img = elm->FirstChild();
	verify(img);
	verify(img->GetLayoutBox());
	verify(img->GetLayoutBox()->IsContentImage());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-increment:foo; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-increment:foo; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: increment")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo -1; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-increment:foo -1; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-increment:foo -1; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: decrement")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("-1"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("-2"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("-3"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="counter-reset:foo 14; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-reset:foo; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-reset:foo -7; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: reset")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("14"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("0"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("-7"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="counter-increment:foo; counter-reset:foo 5; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-increment:foo -1; counter-reset:foo 4; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-increment:foo 2; counter-reset:foo -7; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: reset and increment")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("6"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("-5"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo foo; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-increment:foo -1 foo; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-increment:foo 2 foo 3; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: double increment")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("7"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="counter-reset:foo foo; content:counter(foo);"></div>
	//!  <div id="elm2" style="counter-reset:foo -1 foo; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-reset:foo 2 foo 3; content:counter(foo);"></div>
	//! </body></html>
}
test("counter: double reset")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("0"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("0"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="counter-reset:foo bar;">
	//!  <div id="elm1" style="counter-increment:foo; content:counter(bar);"></div>
	//!  <div id="elm2" style="counter-increment:bar; content:counter(foo);"></div>
	//!  <div id="elm3" style="counter-increment:foo; content:counter(bar);"></div>
	//! </body></html>
}
test("counter: two counters")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("0"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div :first-child { counter-reset:foo; }
	//!  span { counter-increment:foo; content:counter(foo); }
	//! </style></head><body>
	//!  <div>
	//!   <span id="elm1"></span>
	//!   <div>
	//!    <span></span>
	//!    <span></span>
	//!    <span id="elm2"></span>
	//!   </div>
	//!   <span id="elm3"></span>
	//!  </div>
	//! </body></html>
}
test("counter: nested counter")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div :first-child { counter-reset:foo; }
	//!  span { counter-increment:foo; content:counters(foo, "."); }
	//! </style></head><body>
	//!  <div>
	//!   <span id="elm1"></span>
	//!   <span></span>
	//!   <div>
	//!    <span></span>
	//!    <span></span>
	//!    <span id="elm2"></span>
	//!   </div>
	//!   <span id="elm3"></span>
	//!  </div>
	//! </body></html>
}
test("counters: nested counter")
disabled; // this is just too broken in Opera - CORE-941 contains testcases for this (and much more)
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2.3"), 3));
	verify(child->ContentLength() == 3);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div::before { counter-increment:foo; content:counter(foo); }
	//! </style></head><body>
	//!  <div id="elm1"></div>
	//!  <div id="elm2"></div>
	//!  <div id="elm3"></div>
	//! </body></html>
}
test("counter: implicit reset")
disabled; // Has always failed in Opera; see CORE-18991
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* before_pseudo = elm1->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(before_content->Content());
	verify(!uni_strncmp(before_content->Content(), UNI_L("1"), 1));
	verify(before_content->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	before_pseudo = elm2->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());

	before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(before_content->Content());
	verify(!uni_strncmp(before_content->Content(), UNI_L("1"), 1));
	verify(before_content->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	before_pseudo = elm3->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());

	before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(before_content->Content());
	verify(!uni_strncmp(before_content->Content(), UNI_L("1"), 1));
	verify(before_content->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div::before { content:counter(foo); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo;"></div>
	//!  <div id="elm3" style="counter-increment:foo;"></div>
	//! </body></html>
}
test("counter: ::before")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div::after { content:counter(foo); counter-increment:foo; }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1"></div>
	//!  <div id="elm2"></div>
	//!  <div id="elm3"></div>
	//! </body></html>
}
test("counter: ::after")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsInlineContent());
	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div::before, div::after { content:counter(foo); counter-increment:foo; }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm"></div>
	//! </body></html>
}
test("counter: ::before and ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(before_content->Content());
	verify(!uni_strncmp(before_content->Content(), UNI_L("1"), 1));
	verify(before_content->ContentLength() == 1);

	HTML_Element* after_pseudo = before_pseudo->Suc();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineContent());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
	verify(after_content->Content());
	verify(!uni_strncmp(after_content->Content(), UNI_L("2"), 1));
	verify(after_content->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, decimal); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style decimal")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("12"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("123"), 3));
	verify(child->ContentLength() == 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, decimal-leading-zero); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style decimal-leading-zero")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("01"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("12"), 2));
	verify(child->ContentLength() == 2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("123"), 3));
	verify(child->ContentLength() == 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, lower-roman); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style lower-roman")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("i"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("xii"), 3));
	verify(child->ContentLength() == 3);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("cxxiii"), 6));
	verify(child->ContentLength() == 6);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, upper-roman); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style upper-roman")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("I"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("XII"), 3));
	verify(child->ContentLength() == 3);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("CXXIII"), 6));
	verify(child->ContentLength() == 6);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, lower-latin); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style lower-latin")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("a"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("l"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("ds"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, upper-latin); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style upper-latin")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("A"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("L"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("DS"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, lower-alpha); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style lower-alpha")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("a"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("l"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("ds"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  div { content:counter(foo, upper-alpha); }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="counter-increment:foo;"></div>
	//!  <div id="elm2" style="counter-increment:foo 11;"></div>
	//!  <div id="elm3" style="counter-increment:foo 111;"></div>
	//! </body></html>
}
test("counter: style upper-alpha")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("A"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("L"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("DS"), 2));
	verify(child->ContentLength() == 2);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <body style="counter-reset:foo;">
	//!  <div id="elm1" style="content:counter(foo); counter-increment:foo;"></div>
	//!  <div style="display:none; content:counter(foo); counter-increment:foo;"></div>
	//!  <div id="elm2" style="content:counter(foo); counter-increment:foo;"></div>
	//!  <div style="display:none; content:counter(foo); counter-reset:foo;"></div>
	//!  <div id="elm3" style="content:counter(foo); counter-increment:foo;"></div>
	//! </body></html>
}
test("counter: display:none")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <html><head><style>
	//!  .x::before, .y::after { content:normal; counter-increment:foo; }
	//! </style></head><body style="counter-reset:foo;">
	//!  <div id="elm1" style="content:counter(foo); counter-increment:foo;"></div>
	//!  <div class="x"></div>
	//!  <div id="elm2" style="content:counter(foo); counter-increment:foo;"></div>
	//!  <div class="y"></div>
	//!  <div id="elm3" style="content:counter(foo); counter-increment:foo;"></div>
	//! </body></html>
}
test("counter: non-generated pseudo elements")
{
	HTML_Element* child;
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	child = elm1->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("1"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	child = elm2->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("2"), 1));
	verify(child->ContentLength() == 1);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	child = elm3->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("3"), 1));
	verify(child->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  span { quotes:"1" "6" "2" "5" "3" "4"; }
	//!  span::before { content:open-quote; }
	//!  span::after { content:close-quote; }
	//! </style></head><body>
	//!  <span id="elm"><span><span></span></span></span>
	//! </body></html>
}
table QuotationMarkTable(const uni_char*)
{
	{ UNI_L("1") }
	{ UNI_L("2") }
	{ UNI_L("3") }
	{ UNI_L("4") }
	{ UNI_L("5") }
	{ UNI_L("6") }
}
test("quotes: 3 levels")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	iterate(quotation_mark) from QuotationMarkTable
	{
		while (elm && !elm->GetIsGeneratedContent())
			elm = elm->Next();

		verify(elm);

		verify(elm->Content());
		verify(!uni_strncmp(elm->Content(), quotation_mark, 1));
		verify(elm->ContentLength() == 1);

		elm = elm->Next();
	}
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  span { quotes:"1" "6" "2" "5" "3" "4"; }
	//!  span::before { content:open-quote; }
	//!  span::after { content:close-quote; }
	//!  body > span > span::before { content:no-open-quote; }
	//!  body > span > span::after { content:no-close-quote; }
	//! </style></head><body>
	//!  <span id="elm"><span><span></span></span></span>
	//! </body></html>
}
table QuotationMarkTable2(const uni_char*)
{
	{ UNI_L("1") }
	{ UNI_L("3") }
	{ UNI_L("4") }
	{ UNI_L("6") }
}
test("quotes: 3 levels, no-open-quote and no-close-quote")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	iterate(quotation_mark) from QuotationMarkTable2
	{
		while (elm && !elm->GetIsGeneratedContent())
			elm = elm->Next();

		verify(elm);

		verify(elm->Content());
		verify(!uni_strncmp(elm->Content(), quotation_mark, 1));
		verify(elm->ContentLength() == 1);

		elm = elm->Next();
	}
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <q id="elm"></q>
	//! </body></html>
}
test("Q")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(!uni_strncmp(before_content->Content(), "\"", 1));
	verify(before_content->ContentLength() == 1);

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(!uni_strncmp(after_content->Content(), "\"", 1));
	verify(after_content->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <q id="elm" style="quotes:'A' 'B';"></q>
	//! </body></html>
}
test("Q with quotes specified")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(!uni_strncmp(before_content->Content(), "A", 1));
	verify(before_content->ContentLength() == 1);

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(!uni_strncmp(after_content->Content(), "B", 1));
	verify(after_content->ContentLength() == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  q::before, q::after { content:normal; }
	//! </style></head><body>
	//!  <q id="elm"></q>
	//! </body></html>
}
test("Q with ::before,::after{content:normal}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(!before_pseudo || !before_pseudo->GetLayoutBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(!after_pseudo || !after_pseudo->GetLayoutBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="content:-o-language-string(SI_IDFORM_SUBMIT)"></div>
	//! </body></html>
}
test("-o-language-string")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* child = elm->FirstChild();
	verify(child);
	verify(child->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(child->Content());
	verify(!uni_strncmp(child->Content(), UNI_L("Submit"), 6));
	verify(child->ContentLength() == 6);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="width:1000px;">
	//! <br id="elm" style="content:'x'">
	//! </body></html>
}
test("BR with text")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* No spec suggests or demands that there be only one line here, but this
	   appears to be the way we have always behaved. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(!line->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="width:1000px;">
	//! <br id="elm" style="content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==);">
	//! </body></html>
}
test("BR with image")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* No spec suggests or demands that there be only one line here, but this
	   appears to be the way we have always behaved. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(!line->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before { content:"\A"; white-space:pre-line; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before with newline and pre-line")
disabled;
/* content:"\A" and white-space:pre; on BR::before is exactly how CSS 2.1
   appendix D suggests that a BR element be treated. We fail at handling this
   correctly. We create two newlines. Old bug. */
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before { content:none; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before{content:none}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before { content:normal; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before{content:normal}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before { content:"x"; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before{content:text}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before{content:image}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::after { content:none; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::after{content:none}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* There should be two lines. Well, not according to the proposed HTML
	   stylesheet in CSS 2.1, appendix D, but according to all browsers. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::after { content:normal; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::after{content:normal}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* There should be two lines. Well, not according to the proposed HTML
	   stylesheet in CSS 2.1, appendix D, but according to all browsers. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::after { content:"x"; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::after{content:text}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::after{content:image}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before, br::after { content:none; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before,::after{content:none}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* There should be two lines. Well, not according to the proposed HTML
	   stylesheet in CSS 2.1, appendix D, but according to all browsers. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before, br::after { content:normal; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before,::after{content:normal}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	/* There should be two lines. Well, not according to the proposed HTML
	   stylesheet in CSS 2.1, appendix D, but according to all browsers. */

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before, br::after { content:"x"; }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before,::after{content:text}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  br::before, br::after { content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body style="width:1000px;">
	//! &nbsp;<br id="elm">&nbsp;
	//! </body></html>
}
test("BR with ::before,::after{content:image}")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	HTML_Element* body = elm->Parent();
	verify(body->Type() == Markup::HTE_BODY);

	verify(body->GetLayoutBox());
	Container* container = body->GetLayoutBox()->GetContainer();
	verify(container);

	// There should be two lines.

	Line* line = container->GetLineAtVirtualPosition(0);
	verify(line);
	verify(line->Suc());
	verify(line->Suc()->IsLine());
	verify(!line->Suc()->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:hover { content:"hover"; }
	//! </style></head><body style="margin:0;">
	//!  <div style="height:100px;">
	//!   <div id="elm"><span>&nbsp;</span></div>
	//!  </div>
	//! </body></html>
}
test(":hover with content")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	// Move out initially

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	HTML_Element* span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Suc());

	// Hover

	doc->MouseAction(ONMOUSEMOVE, 0, 0, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetLayoutBox());

	HTML_Element* generated_elm = span->Suc();
	verify(generated_elm);
	verify(generated_elm->GetIsGeneratedContent());
	verify(generated_elm->GetLayoutBox());
	verify(generated_elm->GetLayoutBox()->IsTextBox());
	verify(!generated_elm->Suc());

	// Move out again

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:hover::before { content:"hover"; }
	//! </style></head><body style="margin:0;">
	//!  <div style="height:100px;">
	//!   <div id="elm"><span>&nbsp;</span></div>
	//!  </div>
	//! </body></html>
}
test(":hover::before with content")
{
	FramesDocument* doc = state.doc;
	HTML_Element* before_pseudo;
	HTML_Element* before_content;
	HTML_Element* span;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	// Move out initially

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsBeforePseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Suc());

	// Hover

	doc->MouseAction(ONMOUSEMOVE, 0, 0, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	span = before_pseudo->Suc();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Suc());

	// Move out again

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsBeforePseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:hover::after { content:"hover"; }
	//! </style></head><body style="margin:0;">
	//!  <div style="height:100px;">
	//!   <div id="elm"><span>&nbsp;</span></div>
	//!  </div>
	//! </body></html>
}
test(":hover::after with content")
{
	FramesDocument* doc = state.doc;
	HTML_Element* after_pseudo;
	HTML_Element* after_content;
	HTML_Element* span;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	// Move out initially

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->LastChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsAfterPseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Pred());

	// Hover

	doc->MouseAction(ONMOUSEMOVE, 0, 0, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	span = after_pseudo->Pred();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Pred());

	// Move out again

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->LastChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsAfterPseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
	verify(!span->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:hover::before, #elm:hover::after { content:"hover"; }
	//! </style></head><body style="margin:0;">
	//!  <div style="height:100px;">
	//!   <div id="elm"><span>&nbsp;</span></div>
	//!  </div>
	//! </body></html>
}
test(":hover::before and :hover::after with content")
{
	FramesDocument* doc = state.doc;
	HTML_Element* before_pseudo;
	HTML_Element* before_content;
	HTML_Element* after_pseudo;
	HTML_Element* after_content;
	HTML_Element* span;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	// Move out initially

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsBeforePseudoElement());
	verify(!span->GetIsAfterPseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());

	verify(!span->Suc());

	// Hover

	doc->MouseAction(ONMOUSEMOVE, 0, 0, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());

	span = before_pseudo->Suc();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());

	after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());

	verify(after_pseudo->Pred() == span);

	// Move out again

	doc->MouseAction(ONMOUSEMOVE, 0, 100, 0, 0, 0, FALSE, FALSE, FALSE);
	verify(OpStatus::IsSuccess(doc->Reflow(FALSE)));

	verify(elm->GetLayoutBox());
	span = elm->FirstChild();
	verify(span);
	verify(span->Type() == Markup::HTE_SPAN);
	verify(!span->GetIsBeforePseudoElement());
	verify(!span->GetIsAfterPseudoElement());
	verify(span->GetLayoutBox());
	verify(span->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style></style></head><body style="margin:0;">
	//!  <div id="elm"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.styleSheets[0].insertRule("#elm::before { content:'&nbsp;'; }", 0);
	//!  </script>
	//! </body></html>
}
test("insert ::before rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetIsGeneratedContent());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(!before_content->Suc());

	HTML_Element* collapsed_whitespace = before_pseudo->Suc();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  .x::before { content:'&nbsp;'; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm').className = "x";
	//!  </script>
	//! </body></html>
}
test("Change class to get ::before rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* before_pseudo = elm->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* before_content = before_pseudo->FirstChild();
	verify(before_content);
	verify(before_content->GetIsGeneratedContent());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(!before_content->Suc());

	HTML_Element* collapsed_whitespace = before_pseudo->Suc();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm::before { content:'&nbsp;'; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.styleSheets[0].deleteRule(0);
	//!  </script>
	//! </body></html>
}
test("remove ::before rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* collapsed_whitespace = elm->FirstChild();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  .x::before { content:'&nbsp;'; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm" class="x"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm').className = "";
	//!  </script>
	//! </body></html>
}
test("Change class to lose ::before rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* collapsed_whitespace = elm->FirstChild();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style></style></head><body style="margin:0;">
	//!  <div id="elm"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.styleSheets[0].insertRule("#elm::after { content:'&nbsp;'; }", 0);
	//!  </script>
	//! </body></html>
}
test("insert ::after rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetIsGeneratedContent());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
	verify(!after_content->Pred());

	HTML_Element* collapsed_whitespace = after_pseudo->Pred();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  .x::after { content:'&nbsp;'; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm"> </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm').className = "x";
	//!  </script>
	//! </body></html>
}
test("Change class to get ::after rule")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after_pseudo = elm->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineBox());

	HTML_Element* after_content = after_pseudo->FirstChild();
	verify(after_content);
	verify(after_content->GetIsGeneratedContent());
	verify(after_content->GetLayoutBox());
	verify(after_content->GetLayoutBox()->IsTextBox());
	verify(!after_content->Suc());

	HTML_Element* collapsed_whitespace = after_pseudo->Pred();
	verify(collapsed_whitespace);
	verify(collapsed_whitespace->Type() == Markup::HTE_TEXT);
	verify(!collapsed_whitespace->Pred());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  .x::before { display:table-row-group; content:'&nbsp;'; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm" style="display:table-row;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm').className = "x";
	//!  </script>
	//! </body></html>
}
test("Change class on row to get ::before rule with row-group")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);

	HTML_Element* child = elm->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->GetTableContent());
	verify(!child->Suc());

	HTML_Element* before_pseudo = child->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsTableRowGroup());
	verify(!before_pseudo->Suc());

	child = before_pseudo->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	HTML_Element* before_content = child->FirstChild();
	verify(before_content);
	verify(before_content->GetIsGeneratedContent());
	verify(before_content->GetLayoutBox());
	verify(before_content->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());
}
