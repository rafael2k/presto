/* -*- mode: c++; tab-width: 4; c-basic-offset: 4 -*- */

group "layout.positioning";

include "modules/doc/frm_doc.h";
include "modules/dochand/docman.h";
include "modules/layout/box/blockbox.h";
include "modules/layout/traverse/traverse.h";
include "modules/layout/box/box.h";
include "modules/layout/box/tables.h";
include "modules/logdoc/htm_elm.h";

language ecmascript;

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div style="direction:rtl; width:500px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; width:100px; height:100px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos abspos fixed size in fixed-width RTL container")
{
	verify(document.getElementById('elm').offsetLeft == 414);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div style="direction:rtl; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; width:100px; height:100px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos abspos fixed width in auto-width RTL container")
{
	verify(document.getElementById('elm').offsetLeft == 849);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div style="direction:rtl; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute;"><div style="width:100px; height:100px;"></div></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos abspos auto-width in auto-width RTL container")
{
	verify(document.getElementById('elm').offsetLeft == 849);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-cell")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	var cell_padding_box_width = (601 - (12 + 11 + 9 * 3 + 11 + 12)) / 2 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + cell_padding_box_width + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

	// Change table height

	table.style.height = '601px';

	var cell_padding_box_height = (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + cell_padding_box_width + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + cell_padding_box_height + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == cell_padding_box_height);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-cell, collapsed borders")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 100 + 11 + 12);
	verify(top == 10 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

/* Disabling the remaining part of the selftest.
   FIXME: Reflowing collapsed borders is quite broken and has probably always been so.

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '600px';

	var cell_padding_box_width = (600 - 12 * 3) / 2;

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + cell_padding_box_width + 12);
	verify(top == 10 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

	// Change table height

	table.style.height = '600px';

	var cell_padding_box_height = (600 - 12 * 4) / 3;

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + cell_padding_box_width + 12);
	verify(top == 10 + 12 + cell_padding_box_height + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == cell_padding_box_height);
*/
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr>
	//!    <td style="position:relative;" colspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-cell with colspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	var cell_padding_box_width = (601 - (12 + 11 + 9 * 3 + 11 + 12)) / 2 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width + 12 + 9 + 12 + cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);

	// Change table height

	table.style.height = '601px';

	var cell_padding_box_height = (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + cell_padding_box_height + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width + 12 + 9 + 12 + cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == cell_padding_box_height);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td style="position:relative;" rowspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-cell with rowspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	var cell_padding_box_width = (601 - (12 + 11 + 9 * 3 + 11 + 12)) / 2 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + cell_padding_box_width + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11);

	// Change table height

	table.style.height = '601px';

	var cell_padding_box_height = (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 - (12 + 12);

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12 + 11 + 9 + 12 + cell_padding_box_width + 12 + 9 + 12);
	verify(top == 10 + 12 + 11 + 9 + 12 + cell_padding_box_height + 12 + 9 + 12);
	verify(document.getElementById('elm').clientWidth == cell_padding_box_width);
	verify(document.getElementById('elm').clientHeight == cell_padding_box_height + 12 + 9 + 12 + cell_padding_box_height);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td colspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row with colspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td rowspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row with rowspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row-group")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 * 2 + 9);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td colspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row-group with colspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 * 2 + 9);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table>
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td rowspan="2">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table-row-group with rowspan")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12 + 11 + 9);
	verify(top == 10 + 12 + 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9);
	verify(document.getElementById('elm').clientWidth == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12);

	// Change table height

	table.style.height = '601px';

	verify(document.getElementById('elm').clientWidth == 601 - (12 + 11 + 9 * 2 + 11 + 12));
	verify(document.getElementById('elm').clientHeight == (601 - (12 + 11 + 9 * 4 + 11 + 12)) / 3 * 2 + 9);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body>
	//! <table style="position:relative;">
	//!  <thead>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </thead>
	//!  <tbody>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!   <tr>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!    <td><div style="width:100px; height:100px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("abspos in relpos table")
{
	var left = 0;
	var top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}
	verify(left == 8 + 10 + 12);
	verify(top == 10 + 12);
	verify(document.getElementById('elm').clientWidth == 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 11);

	// Change table width

	var table = document.getElementsByTagName('table')[0];
	table.style.width = '601px';

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12);
	verify(top == 10 + 12);
	verify(document.getElementById('elm').clientWidth == 601 - (12 + 12));
	verify(document.getElementById('elm').clientHeight == 11 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 12 + 11 + 100 + 11 + 12 + 9 + 11);

	// Change table height

	table.style.height = '601px';

	left = 0;
	top = 0;
	for (var e = document.getElementById('elm'); e != null; e = e.offsetParent)
	{
		left += e.offsetLeft;
		top += e.offsetTop;
	}

	verify(left == 8 + 10 + 12);
	verify(top == 10 + 12);
	verify(document.getElementById('elm').clientWidth == 601 - (12 + 12));
	verify(document.getElementById('elm').clientHeight == 601 - (12 + 12));
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody>
	//!   <tr>
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-cell CB, collapsed borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody>
	//!   <tr style="border:20px solid white;">
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-cell CB, collapsed with row borders")
disabled;
/* Bug in collapsed borders implementation. A cell's right and bottom borders aren't properly
   collapsed with adjacent row borders, while the top and left borders are. */
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody style="border:20px solid white;">
	//!   <tr>
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-cell CB, collapsed with row-group borders")
disabled;
/* Bug in collapsed borders implementation. A cell's right and bottom borders aren't properly
   collapsed with adjacent row-group borders, while the top and left borders are. */
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; border:20px solid white;">
	//!  <tbody>
	//!   <tr>
	//!    <td style="position:relative;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-cell CB, collapsed with table borders")
disabled;
/* Bug in collapsed borders implementation. A cell's right and bottom borders aren't properly
   collapsed with adjacent table borders, while the top and left borders are. */
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row CB, collapsed borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td style="border:20px solid white;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row CB, collapsed with cell borders")
disabled;
// Bug in collapsed borders implementation. Cells' borders are not collapsed with the row.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody style="border:20px solid white;">
	//!   <tr style="position:relative;">
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row CB, collapsed with row-group borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);

// Bug in collapsed borders implementation. Only the horizontal borders of a table-row group are collapsed with the row.
//	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; border:20px solid white;">
	//!  <tbody>
	//!   <tr style="position:relative;">
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row CB, collapsed with table borders")
disabled;
// Bug in collapsed borders implementation. The table's borders are not collapsed with the row.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row-group CB, collapsed borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td style="border:20px solid white;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row-group CB, collapsed with cell borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse;">
	//!  <tbody style="position:relative;">
	//!   <tr style="border:20px solid white;">
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row-group CB, collapsed with row borders")
disabled;
// Bug in collapsed borders implementation. Only the left and top rows' borders are collapsed with the row-group.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; border:20px solid white;">
	//!  <tbody style="position:relative;">
	//!   <tr>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table-row-group CB, collapsed with table borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; position:relative;">
	//!  <tbody>
	//!   <tr>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table CB, collapsed borders")
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; position:relative;">
	//!  <tbody>
	//!   <tr>
	//!    <td style="border:20px solid white;">
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table CB, collapsed with cell borders")
disabled;
// Bug in collapsed borders implementation. Cells' borders are not collapsed with the table.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; position:relative;">
	//!  <tbody>
	//!   <tr style="border:20px solid white;">
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table CB, collapsed with row borders")
disabled;
// Bug in collapsed borders implementation. Rows' borders are not collapsed with the table.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td { border-spacing:9px; margin:10px; padding:11px; border:12px solid white; box-sizing:border-box; }
	//! </style></head><body style="margin:8px;">
	//! <table style="border-collapse:collapse; position:relative;">
	//!  <tbody style="border:20px solid white;">
	//!   <tr>
	//!    <td>
	//!		<div style="width:100px; height:100px;">
	//!		 <div style="width:100px; height:100px;">
	//!		  <div id="elm" style="position:absolute; left:0; top:0; right:0; bottom:0;"></div>
	//!      </div>
	//!     </div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("Relpos table CB, collapsed with row-group borders")
disabled;
// Bug in collapsed borders implementation. Row-groups' borders are not collapsed with the table.
{
	verify(document.getElementById('elm').clientWidth == 11 + 100 + 11);
	verify(document.getElementById('elm').clientHeight == 11 + 100 + 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td
	//!  {
	//!   border-spacing:9px;
	//!   margin:10px;
	//!   padding:11px;
	//!   border-style:solid;
	//!   border-color:white;
	//!   border-width:12px 17px 12px 12px;
	//!   box-sizing:border-box;
	//!  }
	//!  tr { border:29px solid white; }
	//!  div { text-align:left; }
	//! </style></head><body>
	//! <table style="position:relative;">
	//!  <!-- We have old bugs regarding offsets between a table and one of its captions. So let's be a bit careful and place the caption at the bottom -->
	//!  <caption style="caption-side:bottom; position:relative; text-align:left;">
	//!   <div id="elm0" style="margin:17px;">
	//!    <span id="span0">x</span>
	//!   </div>
	//!  </caption>
	//!  <tbody id="rowgroup1">
	//!   <tr id="row1">
	//!    <td id="elm1"><div style="width:50px; height:50px;"><span id="span1" style="position:relative;">x</span></div></td>
	//!    <td id="elm2"><div style="width:50px; height:50px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup2" style="position:relative;">
	//!   <tr id="row2">
	//!    <td id="elm3"><div style="width:50px; height:50px;"><span id="span2" style="position:relative;">x</span></div></td>
	//!    <td id="elm4"></td>
	//!   </tr>
	//!   <tr id="row3">
	//!    <td id="elm5"><div style="width:50px; height:50px;"><span id="span3" style="position:relative;">x</span></div></td>
	//!    <td id="elm6"></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup3">
	//!   <tr id="row4">
	//!    <td id="elm7"><div style="width:50px; height:50px;"><span id="span4" style="position:relative;">x</span></div></td>
	//!    <td id="elm8" style="position:relative;">
	//!     <div id="elm8_1" style="position:absolute;"></div>
	//!     <div id="elm8_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!   <tr id="row5" style="position:relative;">
	//!    <td id="elm9"><div style="width:50px; height:50px;"><span id="span5" style="position:relative;">x</span></div></td>
	//!    <td id="elm10"></td>
	//!   </tr>
	//!   <tr id="row6">
	//!    <td id="elm11"><div style="width:50px; height:50px;"><span id="span6" style="position:relative;">x</span></div></td>
	//!    <td id="elm12">
	//!     <div id="elm12_1" style="position:absolute;"></div>
	//!     <div id="elm12_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("offset{Left,Top} with pos. table")
{
	// table-caption is offsetParent

	var elm0 = document.getElementById('elm0');
	verify(elm0.offsetLeft == 17);
	verify(elm0.offsetTop == 17);

	var span0 = document.getElementById('span0');
	verify(span0.offsetLeft == 17);
	verify(span0.offsetTop == 17);

	// table is offsetParent

	var rowgroup1 = document.getElementById('rowgroup1');
	verify(rowgroup1.offsetLeft == 12 + 11 + 9);
	verify(rowgroup1.offsetTop == 12 + 11 + 9);

	var row1 = document.getElementById('row1');
	verify(row1.offsetLeft == 12 + 11 + 9);
	verify(row1.offsetTop == 12 + 11 + 9);

	var elm1 = document.getElementById('elm1');
	verify(elm1.offsetLeft == 12 + 11 + 9);
	verify(elm1.offsetTop == 12 + 11 + 9);

	var elm2 = document.getElementById('elm2');
	verify(elm2.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm2.offsetTop == 12 + 11 + 9);

	var rowgroup2 = document.getElementById('rowgroup2');
	verify(rowgroup2.offsetLeft == 12 + 11 + 9);
	verify(rowgroup2.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-row-group is offsetParent

	var row2 = document.getElementById('row2');
	verify(row2.offsetLeft == 0);
	verify(row2.offsetTop == 0);

	var elm3 = document.getElementById('elm3');
	verify(elm3.offsetLeft == 0);
	verify(elm3.offsetTop == 0);

	var span2 = document.getElementById('span2');
	verify(span2.offsetLeft == 12 + 11);
	verify(span2.offsetTop == 12 + 11);

	var elm4 = document.getElementById('elm4');
	verify(elm4.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm4.offsetTop == 0);

	var row3 = document.getElementById('row3');
	verify(row3.offsetLeft == 0);
	verify(row3.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	var elm5 = document.getElementById('elm5');
	verify(elm5.offsetLeft == 0);
	verify(elm5.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	var span3 = document.getElementById('span3');
	verify(span3.offsetLeft == 12 + 11);
	verify(span3.offsetTop == 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm6 = document.getElementById('elm6');
	verify(elm6.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm6.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	// table is offsetParent

	var rowgroup3 = document.getElementById('rowgroup3');
	verify(rowgroup3.offsetLeft == 12 + 11 + 9);
	verify(rowgroup3.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var row4 = document.getElementById('row4');
	verify(row4.offsetLeft == 12 + 11 + 9);
	verify(row4.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var elm7 = document.getElementById('elm7');
	verify(elm7.offsetLeft == 12 + 11 + 9);
	verify(elm7.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var span4 = document.getElementById('span4');
	verify(span4.offsetLeft == 12 + 11 + 9 + 12 + 11);
	verify(span4.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm8 = document.getElementById('elm8');
	verify(elm8.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm8.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-cell is offsetParent

	var elm8_1 = document.getElementById('elm8_1');
	verify(elm8_1.offsetLeft == 12 + 11);
	verify(elm8_1.offsetTop == 12 + 11 + 50 / 2);

	var elm8_2 = document.getElementById('elm8_2');
	verify(elm8_2.offsetLeft == 12 + 7);
	verify(elm8_2.offsetTop == 12 + 7);

	// table is offsetParent

	var row5 = document.getElementById('row5');
	verify(row5.offsetLeft == 12 + 11 + 9);
	verify(row5.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-row is offsetParent

	var elm9 = document.getElementById('elm9');
	verify(elm9.offsetLeft == 0);
	verify(elm9.offsetTop == 0);

	var span5 = document.getElementById('span5');
	verify(span5.offsetLeft == 12 + 11);
	verify(span5.offsetTop == 12 + 11);

	var elm10 = document.getElementById('elm10');
	verify(elm10.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm10.offsetTop == 0);

	// table is offsetParent

	var row6 = document.getElementById('row6');
	verify(row6.offsetLeft == 12 + 11 + 9);
	verify(row6.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var span6 = document.getElementById('span6');
	verify(span6.offsetLeft == 12 + 11 + 9 + 12 + 11);
	verify(span6.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm12_1 = document.getElementById('elm12_1');
	verify(elm12_1.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(elm12_1.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 / 2);

	var elm12_2 = document.getElementById('elm12_2');
	verify(elm12_2.offsetLeft == 12 + 7);
	verify(elm12_2.offsetTop == 12 + 7);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td
	//!  {
	//!   border-spacing:9px;
	//!   margin:10px;
	//!   padding:11px;
	//!   border-style:solid;
	//!   border-color:white;
	//!   border-width:12px 17px 12px 12px;
	//!   box-sizing:border-box;
	//!  }
	//!  tr { border:29px solid white; }
	//!  div { text-align:left; }
	//! </style></head><body>
	//! <table style="position:relative;" dir="rtl">
	//!  <!-- We have old bugs regarding offsets between a table and one of its captions. So let's be a bit careful and place the caption at the bottom -->
	//!  <caption style="caption-side:bottom; position:relative; text-align:left;">
	//!   <div id="elm0" style="margin:17px;">
	//!    <span id="span0">x</span>
	//!   </div>
	//!  </caption>
	//!  <tbody id="rowgroup1">
	//!   <tr id="row1">
	//!    <td id="elm1"><div style="width:50px; height:50px;"><span id="span1" style="position:relative;">x</span></div></td>
	//!    <td id="elm2"><div style="width:50px; height:50px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup2" style="position:relative;">
	//!   <tr id="row2">
	//!    <td id="elm3"><div style="width:50px; height:50px;"><span id="span2" style="position:relative;">x</span></div></td>
	//!    <td id="elm4"></td>
	//!   </tr>
	//!   <tr id="row3">
	//!    <td id="elm5"><div style="width:50px; height:50px;"><span id="span3" style="position:relative;">x</span></div></td>
	//!    <td id="elm6"></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup3">
	//!   <tr id="row4">
	//!    <td id="elm7"><div style="width:50px; height:50px;"><span id="span4" style="position:relative;">x</span></div></td>
	//!    <td id="elm8" style="position:relative;">
	//!     <div id="elm8_1" style="position:absolute;"></div>
	//!     <div id="elm8_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!   <tr id="row5" style="position:relative;">
	//!    <td id="elm9"><div style="width:50px; height:50px;"><span id="span5" style="position:relative;">x</span></div></td>
	//!    <td id="elm10"></td>
	//!   </tr>
	//!   <tr id="row6">
	//!    <td id="elm11"><div style="width:50px; height:50px;"><span id="span6" style="position:relative;">x</span></div></td>
	//!    <td id="elm12">
	//!     <div id="elm12_1" style="position:absolute;"></div>
	//!     <div id="elm12_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("offset{Left,Top} with pos. table, RTL")
{
	// table-caption is offsetParent

	var elm0 = document.getElementById('elm0');
	verify(elm0.offsetLeft == 17);
	verify(elm0.offsetTop == 17);

	var span0 = document.getElementById('span0');
	verify(span0.offsetLeft == 17);
	verify(span0.offsetTop == 17);

	// table is offsetParent

	var rowgroup1 = document.getElementById('rowgroup1');
	verify(rowgroup1.offsetLeft == 12 + 11 + 9);
	verify(rowgroup1.offsetTop == 12 + 11 + 9);

	var row1 = document.getElementById('row1');
	verify(row1.offsetLeft == 12 + 11 + 9);
	verify(row1.offsetTop == 12 + 11 + 9);

	var elm1 = document.getElementById('elm1');
	verify(elm1.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm1.offsetTop == 12 + 11 + 9);

	var elm2 = document.getElementById('elm2');
	verify(elm2.offsetLeft == 12 + 11 + 9);
	verify(elm2.offsetTop == 12 + 11 + 9);

	var rowgroup2 = document.getElementById('rowgroup2');
	verify(rowgroup2.offsetLeft == 12 + 11 + 9);
	verify(rowgroup2.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-row-group is offsetParent

	var row2 = document.getElementById('row2');
	verify(row2.offsetLeft == 0);
	verify(row2.offsetTop == 0);

	var elm3 = document.getElementById('elm3');
	verify(elm3.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm3.offsetTop == 0);

	var span2 = document.getElementById('span2');
	verify(span2.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(span2.offsetTop == 12 + 11);

	var elm4 = document.getElementById('elm4');
	verify(elm4.offsetLeft == 0);
	verify(elm4.offsetTop == 0);

	var row3 = document.getElementById('row3');
	verify(row3.offsetLeft == 0);
	verify(row3.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	var elm5 = document.getElementById('elm5');
	verify(elm5.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm5.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	var span3 = document.getElementById('span3');
	verify(span3.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(span3.offsetTop == 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm6 = document.getElementById('elm6');
	verify(elm6.offsetLeft == 0);
	verify(elm6.offsetTop == 12 + 11 + 50 + 11 + 12 + 9);

	// table is offsetParent

	var rowgroup3 = document.getElementById('rowgroup3');
	verify(rowgroup3.offsetLeft == 12 + 11 + 9);
	verify(rowgroup3.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var row4 = document.getElementById('row4');
	verify(row4.offsetLeft == 12 + 11 + 9);
	verify(row4.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var elm7 = document.getElementById('elm7');
	verify(elm7.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm7.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var span4 = document.getElementById('span4');
	verify(span4.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(span4.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm8 = document.getElementById('elm8');
	verify(elm8.offsetLeft == 12 + 11 + 9);
	verify(elm8.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-cell is offsetParent

	var elm8_1 = document.getElementById('elm8_1');
//	verify(elm8_1.offsetLeft == 12 + 11 + 50); // FIXME: depends on the fix for bug CORE-14281.
	verify(elm8_1.offsetTop == 12 + 11 + 50 / 2);

	var elm8_2 = document.getElementById('elm8_2');
	verify(elm8_2.offsetLeft == 12 + 7);
	verify(elm8_2.offsetTop == 12 + 7);

	// table is offsetParent

	var row5 = document.getElementById('row5');
	verify(row5.offsetLeft == 12 + 11 + 9);
	verify(row5.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	// table-row is offsetParent

	var elm9 = document.getElementById('elm9');
	verify(elm9.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9);
	verify(elm9.offsetTop == 0);

	var span5 = document.getElementById('span5');
	verify(span5.offsetLeft == 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(span5.offsetTop == 12 + 11);

	var elm10 = document.getElementById('elm10');
	verify(elm10.offsetLeft == 0);
	verify(elm10.offsetTop == 0);

	// table is offsetParent

	var row6 = document.getElementById('row6');
	verify(row6.offsetLeft == 12 + 11 + 9);
	verify(row6.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9);

	var span6 = document.getElementById('span6');
	verify(span6.offsetLeft == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 17 + 9 + 12 + 11);
	verify(span6.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11);

	var elm12_1 = document.getElementById('elm12_1');
//	verify(elm12_1.offsetLeft == 12 + 11 + 9 + 12 + 11); // FIXME: depends on the fix for bug CORE-14281.
	verify(elm12_1.offsetTop == 12 + 11 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 + 11 + 12 + 9 + 12 + 11 + 50 / 2);

	var elm12_2 = document.getElementById('elm12_2');
	verify(elm12_2.offsetLeft == 12 + 7);
	verify(elm12_2.offsetTop == 12 + 7);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td
	//!  {
	//!   border-spacing:9px;
	//!   margin:10px;
	//!   padding:11px;
	//!   border-style:solid;
	//!   border-color:white;
	//!   border-width:12px 17px 12px 12px;
	//!   box-sizing:border-box;
	//!   border-collapse:collapse;
	//!  }
	//!  tr { border:29px solid white; }
	//!  div { text-align:left; }
	//! </style></head><body>
	//! <table style="position:relative;">
	//!  <!-- We have old bugs regarding offsets between a table and one of its captions. So let's be a bit careful and place the caption at the bottom -->
	//!  <caption style="caption-side:bottom; position:relative; text-align:left;">
	//!   <div id="elm0" style="margin:17px;">
	//!    <span id="span0">x</span>
	//!   </div>
	//!  </caption>
	//!  <tbody id="rowgroup1">
	//!   <tr id="row1">
	//!    <td id="elm1"><div style="width:50px; height:50px;"><span id="span1" style="position:relative;">x</span></div></td>
	//!    <td id="elm2"><div style="width:50px; height:50px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup2" style="position:relative;">
	//!   <tr id="row2">
	//!    <td id="elm3"><div style="width:50px; height:50px;"><span id="span2" style="position:relative;">x</span></div></td>
	//!    <td id="elm4"></td>
	//!   </tr>
	//!   <tr id="row3">
	//!    <td id="elm5"><div style="width:50px; height:50px;"><span id="span3" style="position:relative;">x</span></div></td>
	//!    <td id="elm6"></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup3">
	//!   <tr id="row4">
	//!    <td id="elm7"><div style="width:50px; height:50px;"><span id="span4" style="position:relative;">x</span></div></td>
	//!    <td id="elm8" style="position:relative;">
	//!     <div id="elm8_1" style="position:absolute;"></div>
	//!     <div id="elm8_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!   <tr id="row5" style="position:relative;">
	//!    <td id="elm9"><div style="width:50px; height:50px;"><span id="span5" style="position:relative;">x</span></div></td>
	//!    <td id="elm10"></td>
	//!   </tr>
	//!   <tr id="row6">
	//!    <td id="elm11"><div style="width:50px; height:50px;"><span id="span6" style="position:relative;">x</span></div></td>
	//!    <td id="elm12">
	//!     <div id="elm12_1" style="position:absolute;"></div>
	//!     <div id="elm12_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("offset{Left,Top} with pos. table, collapsed borders")
{
	// table-caption is offsetParent

	var elm0 = document.getElementById('elm0');
	verify(elm0.offsetLeft == 17);
	verify(elm0.offsetTop == 17);

	var span0 = document.getElementById('span0');
	verify(span0.offsetLeft == 17);
	verify(span0.offsetTop == 17);

	// table is offsetParent

	var rowgroup1 = document.getElementById('rowgroup1');
	verify(rowgroup1.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup1.offsetTop == Math.floor(29 / 2));

	var row1 = document.getElementById('row1');
	verify(row1.offsetLeft == Math.floor(29 / 2));
	verify(row1.offsetTop == Math.floor(29 / 2));

	var elm1 = document.getElementById('elm1');
	verify(elm1.offsetLeft == Math.floor(29 / 2));
	verify(elm1.offsetTop == Math.floor(29 / 2));

	var elm2 = document.getElementById('elm2');
	verify(elm2.offsetLeft == 29 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm2.offsetTop == Math.floor(29 / 2));

	var rowgroup2 = document.getElementById('rowgroup2');
	verify(rowgroup2.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup2.offsetTop == 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-row-group is offsetParent

	var row2 = document.getElementById('row2');
	verify(row2.offsetLeft == 0);
	verify(row2.offsetTop == 0);

	var elm3 = document.getElementById('elm3');
	verify(elm3.offsetLeft == 0);
	verify(elm3.offsetTop == 0);

	var span2 = document.getElementById('span2');
	verify(span2.offsetLeft == Math.floor((29 + 1) / 2) + 11);
	verify(span2.offsetTop == Math.floor((29 + 1) / 2) + 11);

	var elm4 = document.getElementById('elm4');
	verify(elm4.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm4.offsetTop == 0);

	var row3 = document.getElementById('row3');
	verify(row3.offsetLeft == 0);
	verify(row3.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	var elm5 = document.getElementById('elm5');
	verify(elm5.offsetLeft == 0);
	verify(elm5.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	var span3 = document.getElementById('span3');
	verify(span3.offsetLeft == Math.floor(29 + 1) / 2 + 11);
	verify(span3.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + 29 + 11);

	var elm6 = document.getElementById('elm6');
	verify(elm6.offsetLeft == Math.floor(29 + 1) / 2 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm6.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	// table is offsetParent

	var rowgroup3 = document.getElementById('rowgroup3');
	verify(rowgroup3.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup3.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var row4 = document.getElementById('row4');
	verify(row4.offsetLeft == Math.floor(29 / 2));
	verify(row4.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var elm7 = document.getElementById('elm7');
	verify(elm7.offsetLeft == Math.floor(29 / 2));
	verify(elm7.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var span4 = document.getElementById('span4');
	verify(span4.offsetLeft == 29 + 11);
	verify(span4.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11);

	var elm8 = document.getElementById('elm8');
	verify(elm8.offsetLeft == 29 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm8.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-cell is offsetParent

	var elm8_1 = document.getElementById('elm8_1');
	verify(elm8_1.offsetLeft == Math.floor((17 + 1) / 2) + 11);
	verify(elm8_1.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 / 2);

	var elm8_2 = document.getElementById('elm8_2');
	verify(elm8_2.offsetLeft == Math.floor((17 + 1) / 2) + 7);
	verify(elm8_2.offsetTop == Math.floor((29 + 1) / 2) + 7);

	// table is offsetParent

	var row5 = document.getElementById('row5');
	verify(row5.offsetLeft == Math.floor(29 / 2));
	verify(row5.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-row is offsetParent

	var elm9 = document.getElementById('elm9');
	verify(elm9.offsetLeft == 0);
	verify(elm9.offsetTop == 0);

	var span5 = document.getElementById('span5');
	verify(span5.offsetLeft == Math.floor((29 + 1) / 2) + 11);
	verify(span5.offsetTop == Math.floor((29 + 1) / 2) + 11);

	var elm10 = document.getElementById('elm10');
	verify(elm10.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm10.offsetTop == 0);

	// table is offsetParent

	var row6 = document.getElementById('row6');
	verify(row6.offsetLeft == Math.floor(29 / 2));
	verify(row6.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var span6 = document.getElementById('span6');
	verify(span6.offsetLeft == 29 + 11);
	verify(span6.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11);

	var elm12_1 = document.getElementById('elm12_1');
	verify(elm12_1.offsetLeft == 29 + 11 + 50 + 11 + 17 + 11);
	verify(elm12_1.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 / 2);

	var elm12_2 = document.getElementById('elm12_2');
//	verify(elm12_2.offsetLeft == 29 + 7); // Old bug; see selftest "Relpos table CB, collapsed with row borders"
//	verify(elm12_2.offsetTop == 29 + 7); // Old bug; see selftest "Relpos table CB, collapsed with row borders"
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  table, thead, tbody, tr, td
	//!  {
	//!   border-spacing:9px;
	//!   margin:10px;
	//!   padding:11px;
	//!   border-style:solid;
	//!   border-color:white;
	//!   border-width:12px 17px 12px 12px;
	//!   box-sizing:border-box;
	//!   border-collapse:collapse;
	//!  }
	//!  tr { border:29px solid white; }
	//!  div { text-align:left; }
	//! </style></head><body>
	//! <table style="position:relative;" dir="rtl">
	//!  <!-- We have old bugs regarding offsets between a table and one of its captions. So let's be a bit careful and place the caption at the bottom -->
	//!  <caption style="caption-side:bottom; position:relative; text-align:left;">
	//!   <div id="elm0" style="margin:17px;">
	//!    <span id="span0">x</span>
	//!   </div>
	//!  </caption>
	//!  <tbody id="rowgroup1">
	//!   <tr id="row1">
	//!    <td id="elm1"><div style="width:50px; height:50px;"><span id="span1" style="position:relative;">x</span></div></td>
	//!    <td id="elm2"><div style="width:50px; height:50px;"></div></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup2" style="position:relative;">
	//!   <tr id="row2">
	//!    <td id="elm3"><div style="width:50px; height:50px;"><span id="span2" style="position:relative;">x</span></div></td>
	//!    <td id="elm4"></td>
	//!   </tr>
	//!   <tr id="row3">
	//!    <td id="elm5"><div style="width:50px; height:50px;"><span id="span3" style="position:relative;">x</span></div></td>
	//!    <td id="elm6"></td>
	//!   </tr>
	//!  </tbody>
	//!  <tbody id="rowgroup3">
	//!   <tr id="row4">
	//!    <td id="elm7"><div style="width:50px; height:50px;"><span id="span4" style="position:relative;">x</span></div></td>
	//!    <td id="elm8" style="position:relative;">
	//!     <div id="elm8_1" style="position:absolute;"></div>
	//!     <div id="elm8_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!   <tr id="row5" style="position:relative;">
	//!    <td id="elm9"><div style="width:50px; height:50px;"><span id="span5" style="position:relative;">x</span></div></td>
	//!    <td id="elm10"></td>
	//!   </tr>
	//!   <tr id="row6">
	//!    <td id="elm11"><div style="width:50px; height:50px;"><span id="span6" style="position:relative;">x</span></div></td>
	//!    <td id="elm12">
	//!     <div id="elm12_1" style="position:absolute;"></div>
	//!     <div id="elm12_2" style="position:absolute; top:7px; left:7px;"></div>
	//!    </td>
	//!   </tr>
	//!  </tbody>
	//! </table>
	//! </body></html>
}
test("offset{Left,Top} with pos. table, collapsed borders, RTL")
/* Since the table's left border isn't collapsed with the row's left border (old bug), a lot of
   verify() statements below are commented out. FIXME. */
{
	// table-caption is offsetParent

	var elm0 = document.getElementById('elm0');
	verify(elm0.offsetLeft == 17);
	verify(elm0.offsetTop == 17);

	var span0 = document.getElementById('span0');
	verify(span0.offsetLeft == 17);
	verify(span0.offsetTop == 17);

	// table is offsetParent

	var rowgroup1 = document.getElementById('rowgroup1');
//	verify(rowgroup1.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup1.offsetTop == Math.floor(29 / 2));

	var row1 = document.getElementById('row1');
//	verify(row1.offsetLeft == Math.floor(29 / 2));
	verify(row1.offsetTop == Math.floor(29 / 2));

	var elm1 = document.getElementById('elm1');
//	verify(elm1.offsetLeft == 29 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm1.offsetTop == Math.floor(29 / 2));

	var elm2 = document.getElementById('elm2');
//	verify(elm2.offsetLeft == Math.floor(29 / 2));
	verify(elm2.offsetTop == Math.floor(29 / 2));

	var rowgroup2 = document.getElementById('rowgroup2');
//	verify(rowgroup2.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup2.offsetTop == 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-row-group is offsetParent

	var row2 = document.getElementById('row2');
	verify(row2.offsetLeft == 0);
	verify(row2.offsetTop == 0);

	var elm3 = document.getElementById('elm3');
	verify(elm3.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm3.offsetTop == 0);

	var span2 = document.getElementById('span2');
	verify(span2.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + 17 + 11);
	verify(span2.offsetTop == Math.floor((29 + 1) / 2) + 11);

	var elm4 = document.getElementById('elm4');
	verify(elm4.offsetLeft == 0);
	verify(elm4.offsetTop == 0);

	var row3 = document.getElementById('row3');
	verify(row3.offsetLeft == 0);
	verify(row3.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	var elm5 = document.getElementById('elm5');
	verify(elm5.offsetLeft == Math.floor(29 + 1) / 2 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm5.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	var span3 = document.getElementById('span3');
	verify(span3.offsetLeft == Math.floor(29 + 1) / 2 + 11 + 50 + 11 + 17 + 11);
	verify(span3.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + 29 + 11);

	var elm6 = document.getElementById('elm6');
	verify(elm6.offsetLeft == 0);
	verify(elm6.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(29 / 2));

	// table is offsetParent

	var rowgroup3 = document.getElementById('rowgroup3');
//	verify(rowgroup3.offsetLeft == Math.floor(29 / 2));
	verify(rowgroup3.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var row4 = document.getElementById('row4');
//	verify(row4.offsetLeft == Math.floor(29 / 2));
	verify(row4.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var elm7 = document.getElementById('elm7');
//	verify(elm7.offsetLeft == 29 + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm7.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var span4 = document.getElementById('span4');
//	verify(span4.offsetLeft == 29 + 11 + 50 + 11 + 17 + 11);
	verify(span4.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11);

	var elm8 = document.getElementById('elm8');
//	verify(elm8.offsetLeft == Math.floor(29 / 2));
	verify(elm8.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-cell is offsetParent

	var elm8_1 = document.getElementById('elm8_1');
//	verify(elm8_1.offsetLeft == Math.floor((17 + 1) / 2) + 11 + 50); // FIXME: depends on the fix for bug CORE-14281.
	verify(elm8_1.offsetTop == Math.floor((29 + 1) / 2) + 11 + 50 / 2);

	var elm8_2 = document.getElementById('elm8_2');
//	verify(elm8_2.offsetLeft == Math.floor((29 + 1) / 2) + 7);
	verify(elm8_2.offsetTop == Math.floor((29 + 1) / 2) + 7);

	// table is offsetParent

	var row5 = document.getElementById('row5');
//	verify(row5.offsetLeft == Math.floor(29 / 2));
	verify(row5.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	// table-row is offsetParent

	var elm9 = document.getElementById('elm9');
	verify(elm9.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + Math.floor(17 / 2));
	verify(elm9.offsetTop == 0);

	var span5 = document.getElementById('span5');
	verify(span5.offsetLeft == Math.floor((29 + 1) / 2) + 11 + 50 + 11 + 17 + 11);
	verify(span5.offsetTop == Math.floor((29 + 1) / 2) + 11);

	var elm10 = document.getElementById('elm10');
	verify(elm10.offsetLeft == 0);
	verify(elm10.offsetTop == 0);

	// table is offsetParent

	var row6 = document.getElementById('row6');
//	verify(row6.offsetLeft == Math.floor(29 / 2));
	verify(row6.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + Math.floor(29 / 2));

	var span6 = document.getElementById('span6');
//	verify(span6.offsetLeft == 29 + 11 + 50 + 11 + 17 + 11);
	verify(span6.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11);

	var elm12_1 = document.getElementById('elm12_1');
//	verify(elm12_1.offsetLeft == 29 + 11 + 50); // FIXME: depends on the fix for bug CORE-14281.
	verify(elm12_1.offsetTop == 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 + 11 + 29 + 11 + 50 / 2);

	var elm12_2 = document.getElementById('elm12_2');
//	verify(elm12_2.offsetLeft == 29 + 7); // Old bug; see selftest "Relpos table CB, collapsed with row borders"
//	verify(elm12_2.offsetTop == 29 + 7); // Old bug; see selftest "Relpos table CB, collapsed with row borders"
}

language c++;

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="position:relative;">
	//!   <caption style="position:relative;"></caption>
	//!   <tbody style="position:relative;">
	//!    <tr style="position:relative;">
	//!     <td style="position:relative;"></td>
	//!    </tr>
	//!   </tbody>
	//!   <caption style="position:relative;"></caption>
	//!  </table>
	//! </body></html>
}
test("table paint order test, all in same stacking context")
{
	FramesDocument* doc = state.doc;
	verify(doc != NULL);
	verify(doc->GetDocRoot() != NULL);

	Box* root_box = doc->GetDocRoot()->GetLayoutBox();
	verify(root_box);

	StackingContext* root_stacking_context = root_box->GetLocalStackingContext();
	verify(root_stacking_context);

	ZElement* z_elm = (ZElement*) root_stacking_context->First();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TABLE);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_CAPTION);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TBODY);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TR);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TD);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_CAPTION);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(!z_elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="position:relative;">
	//!   <caption style="position:relative; z-index:10;"></caption>
	//!   <tbody style="position:relative; z-index:9;">
	//!    <tr style="position:relative; z-index:7; ">
	//!     <td style="position:relative;"></td>
	//!    </tr>
	//!    <tr style="position:relative;">
	//!     <td style="position:relative; z-index:8;"></td>
	//!    </tr>
	//!   </tbody>
	//!   <caption style="position:relative; z-index:6;"></caption>
	//!  </table>
	//! </body></html>
}
test("table paint order test, different stacking contexts")
{
	FramesDocument* doc = state.doc;
	verify(doc != NULL);
	verify(doc->GetDocRoot() != NULL);

	Box* root_box = doc->GetDocRoot()->GetLayoutBox();
	verify(root_box);

	StackingContext* root_stacking_context = root_box->GetLocalStackingContext();
	verify(root_stacking_context);

	// examine root stacking context

	ZElement* z_elm = (ZElement*) root_stacking_context->First();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TABLE);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_CAPTION);
	verify(z_elm->GetZIndex() == 6);
	verify(z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext()->First());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TBODY);
	verify(z_elm->GetZIndex() == 9);

	StackingContext* tbody_stacking_context = z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext();
	verify(tbody_stacking_context);

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_CAPTION);
	verify(z_elm->GetZIndex() == 10);
	verify(z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext()->First());

	z_elm = (ZElement*) z_elm->Suc();
	verify(!z_elm);

	// examine TBODY stacking context

	z_elm = (ZElement*) tbody_stacking_context->First();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TR);
	verify(((TableRowBox*) z_elm->GetHtmlElement()->GetLayoutBox())->Pred()); // second row
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TR);
	verify(!((TableRowBox*) z_elm->GetHtmlElement()->GetLayoutBox())->Pred()); // first row
	verify(z_elm->GetZIndex() == 7);

	StackingContext* tr_stacking_context = z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext();
	verify(tr_stacking_context);

	z_elm = (ZElement*) z_elm->Suc();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TD);
	verify(z_elm->GetZIndex() == 8);
	verify(z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext()->First());

	z_elm = (ZElement*) z_elm->Suc();
	verify(!z_elm);

	// examine TR stacking context

	z_elm = (ZElement*) tr_stacking_context->First();
	verify(z_elm);
	verify(z_elm->GetHtmlElement()->Type() == Markup::HTE_TD);
	verify(z_elm->GetZIndex() == 0);
	verify(!z_elm->GetHtmlElement()->GetLayoutBox()->GetLocalStackingContext());

	z_elm = (ZElement*) z_elm->Suc();
	verify(!z_elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="border-spacing:0;">
	//!   <tbody>
	//!    <tr>
	//!     <td style="padding:0; position:relative; z-index:0;">
	//!      <div style="width:100px; height:0;">
	//!       <div style="width:100px; height:0;">
	//!        <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!       </div>
	//!      </div>
	//!     </td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("table-cell stacking context, skip children")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="border-spacing:0;">
	//!   <tbody>
	//!    <tr style="position:relative; z-index:0;">
	//!     <td style="padding:0;">
	//!      <div style="width:100px; height:0;">
	//!       <div style="width:100px; height:0;">
	//!        <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!       </div>
	//!      </div>
	//!     </td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("table-row stacking context, skip children")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="border-spacing:0;">
	//!   <tbody style="position:relative; z-index:0;">
	//!    <tr>
	//!     <td style="padding:0;">
	//!      <div style="width:100px; height:0;">
	//!       <div style="width:100px; height:0;">
	//!        <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!       </div>
	//!      </div>
	//!     </td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("table-row-group stacking context, skip children")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="border-spacing:0;">
	//!   <caption style="position:relative; z-index:0;">
	//!    <div style="width:100px; height:0;">
	//!     <div style="width:100px; height:0;">
	//!      <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!     </div>
	//!    </div>
	//!   </caption>
	//!   <tbody>
	//!    <tr>
	//!     <td></td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("table-caption stacking context, skip children")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="border-spacing:0; position:relative; z-index:0;">
	//!   <tbody>
	//!    <tr>
	//!     <td style="padding:0;">
	//!      <div style="width:100px; height:0;">
	//!       <div style="width:100px; height:0;">
	//!        <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!       </div>
	//!      </div>
	//!     </td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("table stacking context, skip children")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body>
	//!  <table style="display:inline-table; border-spacing:0; position:relative; z-index:0;">
	//!   <tbody>
	//!    <tr>
	//!     <td style="padding:0;">
	//!      <div style="width:100px; height:0;">
	//!       <div style="width:100px; height:0;">
	//!        <div id="elm" style="position:absolute; right:0; width:100px; height:1px;"></div>
	//!       </div>
	//!      </div>
	//!     </td>
	//!    </tr>
	//!   </tbody>
	//!  </table>
	//!  <script>
	//!   document.body.offsetLeft; // trigger reflow
	//!   document.getElementsByTagName('table')[0].style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("inline-table stacking context, skip children")
{
	state.doc->Reflow(FALSE); // FIXME: This is necessary in this particular case. Don't ask me why.

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));

	verify(elm);
	verify(elm->GetLayoutBox());
	verify(((AbsolutePositionedBox*) elm->GetLayoutBox())->GetX() == 100);
}

language ecmascript;

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute;">
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos abspos auto-width with wrapping content")
{
	verify(document.getElementById('elm').offsetWidth == 988);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; border:1px solid transparent; direction:rtl; padding:2px;">
	//!  <div style="margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute;">
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos abspos auto-width with wrapping content (RTL)")
{
	verify(document.getElementById('elm').offsetWidth == 951);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; border:1px solid transparent; direction:rtl; padding:2px;">
	//!  <div id="elm" style="position:absolute; direction:ltr;">
	//!   <div style="width:200px; height:10px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos LTR abspos in RTL container")
{
	verify(document.getElementById('elm').offsetLeft == 803);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; border:1px solid transparent; direction:ltr; padding:2px;">
	//!  <div id="elm" style="position:absolute; direction:rtl;">
	//!   <div style="width:200px; height:10px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos RTL abspos in LTR container")
{
	verify(document.getElementById('elm').offsetLeft == 3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed;">
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos fixedpos auto-width with wrapping content")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	Box* box = elm->GetLayoutBox();
	verify(box);

	/* First the prerequisite. We use a fixed positioned box so we
	   have a dependency on the layout viewport width being within a
	   certain interval. */

	verify(doc->GetLayoutViewWidth() >= 425 && doc->GetLayoutViewWidth() < 3225);

	verify(box->GetWidth() == doc->GetLayoutViewWidth() - 25);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px; direction:rtl;">
	//!  <div style="margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed;">
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!    <div style="display:inline-block; width:400px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos fixedpos auto-width with wrapping content (RTL)")
{
	verify(document.getElementById('elm').offsetWidth == 960);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px; direction:rtl;">
	//!  <div id="elm" style="position:fixed; direction:ltr;">
	//!   <div style="width:200px; height:10px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos LTR fixedpos in RTL container")
{
	verify(document.getElementById('elm').offsetLeft == 811);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px; direction:ltr;">
	//!  <div id="elm" style="position:fixed; direction:rtl;">
	//!   <div style="width:200px; height:10px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("auto-pos RTL fixedpos in LTR container")
{
	verify(document.getElementById('elm').offsetLeft == 11);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div id="elm" style="position:absolute; left:100px; right:100px; margin:20px; height:10px;"></div>
	//! </div>
	//! </body></html>
}
test("auto-width abspos with fixed left and right")
{
	verify(document.getElementById('elm').offsetWidth == 760);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached auto-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 980);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 980);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached %-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1506);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1506);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached fixed-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1500);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached auto-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == 8);
	verify(document.getElementById('elm').offsetWidth == 980);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 8);
	verify(document.getElementById('elm').offsetWidth == 980);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached %-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == -518);
	verify(document.getElementById('elm').offsetWidth == 1506);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == -518);
	verify(document.getElementById('elm').offsetWidth == 1506);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached fixed-width abspos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == -512);
	verify(document.getElementById('elm').offsetWidth == 1500);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == -512);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached auto-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 980);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 980);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached %-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1506);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1506);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; left:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached fixed-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1500);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 18);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached auto-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == 8);
	verify(document.getElementById('elm').offsetWidth == 980);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == 8);
	verify(document.getElementById('elm').offsetWidth == 980);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached %-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == -518);
	verify(document.getElementById('elm').offsetWidth == 1506);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == -518);
	verify(document.getElementById('elm').offsetWidth == 1506);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:absolute; margin:7px; right:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached fixed-width abspos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == -512);
	verify(document.getElementById('elm').offsetWidth == 1500);
	document.getElementById('elm').style.display = 'table';
	verify(document.getElementById('elm').offsetLeft == -512);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached auto-width fixedpos, LTR")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() - 24);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached %-width fixedpos, LTR")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 150 / 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached fixed-width fixedpos, LTR")
{
	verify(document.getElementById('elm').offsetLeft == 17);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached auto-width fixedpos, LTR")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 7);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() - 24);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached %-width fixedpos, LTR")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == doc->GetLayoutViewWidth() - doc->GetLayoutViewWidth() * 150 / 100 - 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 150 / 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached fixed-width fixedpos, LTR")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == doc->GetLayoutViewWidth() - 1517);
	verify(box->GetWidth() == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached auto-width fixedpos, RTL")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() - 24);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached %-width fixedpos, RTL")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 150 / 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; left:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("left-attached fixed-width fixedpos, RTL")
{
	verify(document.getElementById('elm').offsetLeft == 17);
	verify(document.getElementById('elm').offsetWidth == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached auto-width fixedpos, RTL")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == 7);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() - 24);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px; width:150%;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached %-width fixedpos, RTL")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == doc->GetLayoutViewWidth() - doc->GetLayoutViewWidth() * 150 / 100 - 17);
	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 150 / 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; direction:rtl;">
	//! <div style="position:relative; width:1000px; border:1px solid transparent; padding:2px;">
	//!  <div style="width:700px; margin:3px; border:11px solid blue; padding-right:37px;">
	//!   <div id="elm" style="position:fixed; margin:7px; right:10px; width:1500px;">
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!    <div style="display:inline-block; width:200px; height:100px;"></div> <div style="display:inline-block; width:200px; height:100px;"></div>
	//!   </div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("right-attached fixed-width fixedpos, RTL")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	AbsolutePositionedBox* box = (AbsolutePositionedBox*) elm->GetLayoutBox();
	verify(box);
	verify(box->IsAbsolutePositionedBox());

	verify(box->GetX() == doc->GetLayoutViewWidth() - 1517);
	verify(box->GetWidth() == 1500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px;"></div>
	//! </div>
	//! </body></html>
}
test("over-constrained abspos in LTR container")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; direction:rtl;">
	//!  <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px;"></div>
	//! </div>
	//! </body></html>
}
test("over-constrained abspos in RTL container")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 800);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; ritection:ltr;">
	//!  <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px; direction:rtl;"></div>
	//! </div>
	//! </body></html>
}
test("over-constrained RTL abspos in LTR container")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; direction:ltr;">
	//!  <div style="direction:rtl;">
	//!   <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px; direction:ltr;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("over-constrained LTR abspos in RTL container in LTR CB")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; direction:rtl;">
	//!  <div style="direction:ltr;">
	//!   <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px; direction:rtl;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("over-constrained RTL abspos in LTR container in RTL CB")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 800);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px; direction:rtl;">
	//!  <div id="elm" style="position:absolute; left:0; right:0; width:200px; height:10px; direction:ltr;"></div>
	//! </div>
	//! </body></html>
}
test("over-constrained LTR abspos in RTL container")
{
	verify(document.getElementById('elm').offsetWidth == 200);
	verify(document.getElementById('elm').offsetLeft == 800);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div style="margin:100px;">
	//!   <div id="elm" style="position:absolute; width:50%; height:10px;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("Abspos with % width")
{
	verify(document.getElementById('elm').offsetWidth == 500);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div style="position:relative; width:1000px;">
	//!  <div id="elm" style="position:fixed; left:0; width:50%; height:10px;"></div>
	//! </div>
	//! </body></html>
}
test("Fixedpos with % width")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	Box* box = elm->GetLayoutBox();
	verify(box);

	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 50 / 100);
	verify(box->GetHeight() == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="overflow: hidden">
	//! <div style="position:relative; width:1000px;">
	//!  <div id="elm" style="position:fixed; left:0; width:50%; height:50%;"></div>
	//! </div>
	//! </body></html>
}
test("Fixedpos with % width and height")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	Box* box = elm->GetLayoutBox();
	verify(box);

	verify(box->GetWidth() == doc->GetLayoutViewWidth() * 50 / 100);
	verify(box->GetHeight() == doc->GetLayoutViewHeight() * 50 / 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:8px; overflow:hidden">
	//! <div style="position:relative; width:1000px;">
	//!  <div style="position:fixed; left:100px; right:0; top:100px; bottom:0;">
	//!   <div id="elm" style="position:fixed; left:0; right:0; top:0; bottom:0;"></div>
	//!  </div>
	//! </div>
	//! </body></html>
}
test("Fixedpos with left/right inside another fixedpos")
language c++;
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);

	Box* box = elm->GetLayoutBox();
	verify(box);

	verify(box->GetWidth() == doc->GetLayoutViewWidth());
	verify(box->GetHeight() == doc->GetLayoutViewHeight());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  &nbsp;
	//!  <div id="elm" style="display:inline; position:absolute; width:100ox; height:10px;"></div>
	//! </body></html>
}
test("Abspos with display:inline following word")
{
	verify(document.getElementById('elm').offsetLeft > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!   <div style="width:0; height:0;">
	//!    <div id="elm2" style="position:absolute; width:100px; height:100px; margin:10% 0;"></div>
	//!   </div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '200px';
	//!  </script>
	//! </body></html>
}
test("Change width of CB for abspos with % vertical margins")
{
	verify(document.getElementById('elm2').offsetTop == 20);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <div id="elm2" style="position:absolute;bottom:0;top:0">
	//!    </div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom")
{
	verify(document.getElementById('elm2').offsetTop == 0);
	verify(document.getElementById('elm2').offsetHeight == 400);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:800px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; bottom:300px; margin-top:auto; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom, auto top/bottom-margin")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:800px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; bottom:300px; height:100px; margin-top:auto; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom, fixed height, auto top/bottom-margin")
{
	verify(document.getElementById('elm2').offsetTop == 350);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:800px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; height:100px; margin-top:auto; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top, fixed height, auto top/bottom-margin")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:800px; position:relative;">
	//!    <div id="elm2" style="position:absolute; bottom:300px; height:100px; margin-top:auto; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto bottom, fixed height, auto top/bottom-margin")
{
	verify(document.getElementById('elm2').offsetTop == 400);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; bottom:300px; margin-top:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom, auto margin-top, insuff. space")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; bottom:300px; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom, auto bottom-margin, insuff. space")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <div id="elm2" style="position:absolute; top:300px; bottom:300px; margin-top:auto; margin-bottom:auto;"></div>
	//!  </div>
	//! </body></html>
}
test("non-auto top/bottom, auto top/bottom-margin, insuff. space")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute;bottom:0;height:100px;">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto bottom")
{
	verify(document.getElementById('elm2').offsetTop == 300);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute; top:100px; bottom:0; margin:auto; padding-bottom:10px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto top/bottom, auto margins, auto height")
{
	verify(document.getElementById('elm2').offsetTop == 195);
	verify(document.getElementById('elm2').offsetHeight == 110);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute; top:100px; bottom:0; margin:auto; max-height:100px; min-height:200px; padding-bottom:10px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto top/bottom, auto margins, min-h/max-h")
{
	verify(document.getElementById('elm2').offsetTop == 145);
	verify(document.getElementById('elm2').offsetHeight == 210);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute;bottom:0;top:0;height:200px;margin-top:auto;margin-bottom:auto">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto top/bottom, auto margins")
{
	verify(document.getElementById('elm2').offsetTop == 100);
	verify(document.getElementById('elm2').offsetHeight == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute;bottom:0;top:0;height:100px;min-height:200px;margin-top:auto;margin-bottom:auto">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto top/bottom, auto margins, min-h")
{
	verify(document.getElementById('elm2').offsetTop == 100);
	verify(document.getElementById('elm2').offsetHeight == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <img id="elm2" style="position:absolute;bottom:0;top:0;height:400px;max-height:200px;margin-top:auto;margin-bottom:auto">
	//!  </div>
	//! </body></html>
}
test("replaced non-auto top/bottom, auto margins, max-h")
{
	verify(document.getElementById('elm2').offsetTop == 100);
	verify(document.getElementById('elm2').offsetHeight == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm1" style="width:400px; height:400px; position:relative;">
	//!    <div id="elm2" style="position:absolute;bottom:100px">
	//!      <div style="height:200px">
	//!    </div>
	//!  </div>
	//! </body></html>
}
test("non-auto bottom, propagated content")
{
	verify(document.getElementById('elm2').offsetTop == 100);
	verify(document.getElementById('elm2').offsetHeight == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:0; right:100px; margin:auto; width:100px;">
	//!    <div style="width:1000px; height:1000px;"></div>
	//!   </div>
	//! </body></html>
}
test("non-auto left/right, auto margins, width")
{
	verify(document.getElementById('abs').offsetWidth == 100);
	verify(document.getElementById('abs').offsetLeft == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:0; right:100px; margin:auto; max-width:100px;">
	//!    <div style="width:1000px; height:1000px;"></div>
	//!   </div>
	//! </body></html>
}
test("non-auto left/right, auto margins, max-w")
{
	verify(document.getElementById('abs').offsetWidth == 100);
	verify(document.getElementById('abs').offsetLeft == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:0; right:100px; margin:auto; width:200px; max-width:100px;">
	//!    <div style="width:1000px; height:1000px;"></div>
	//!   </div>
	//! </body></html>
}
test("non-auto left/right, auto margins, width/max-w")
{
	verify(document.getElementById('abs').offsetWidth == 100);
	verify(document.getElementById('abs').offsetLeft == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:0; right:100px; margin:auto; max-width:50px; min-width:100px;">
	//!    <div style="width:1000px; height:1000px;"></div>
	//!   </div>
	//! </body></html>
}
test("non-auto left/right, auto margins, max-w/min-w")
{
	verify(document.getElementById('abs').offsetWidth == 100);
	verify(document.getElementById('abs').offsetLeft == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <img id="abs" style="position:absolute; left:0; right:100px; padding-right:10px; margin:auto;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//! </body></html>
}
test("replaced non-auto left/right, auto margins")
{
	verify(document.getElementById('abs').offsetWidth == 110);
	verify(document.getElementById('abs').offsetLeft == 95);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <img id="abs" style="position:absolute; left:0; right:100px; padding-right:10px; margin:auto; width:200px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//! </body></html>
}
test("replaced non-auto left/right, auto margins, width")
{
	verify(document.getElementById('abs').offsetWidth == 210);
	verify(document.getElementById('abs').offsetLeft == 45);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <img id="abs" style="position:absolute; left:0; right:100px; padding-right:10px; margin:auto; max-width:50px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//! </body></html>
}
test("replaced non-auto left/right, auto margins, max-w")
{
	verify(document.getElementById('abs').offsetWidth == 60);
	verify(document.getElementById('abs').offsetLeft == 120);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <img id="abs" style="position:absolute; left:0; right:100px; padding-right:10px; margin:auto; width:90px; max-width:50px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//! </body></html>
}
test("replaced non-auto left/right, auto margins, width/max-w")
{
	verify(document.getElementById('abs').offsetWidth == 60);
	verify(document.getElementById('abs').offsetLeft == 120);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <img id="abs" style="position:absolute; left:0; right:100px; padding-right:10px; margin:auto; max-width:50px; min-width:200px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==">
	//! </body></html>
}
test("replaced non-auto left/right, auto margins, max-w/min-w")
{
	verify(document.getElementById('abs').offsetWidth == 210);
	verify(document.getElementById('abs').offsetLeft == 45);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:50px; right:50px; top:50px; bottom:50px; margin:auto; width:500px; height:500px;"></div>
	//! </body></html>
}
test("auto margins, wide and tall")
{
	verify(document.getElementById('abs').offsetWidth == 500);
	verify(document.getElementById('abs').offsetHeight == 500);
	verify(document.getElementById('abs').offsetLeft == 50); // Auto horizontal margins may not become negative.
	verify(document.getElementById('abs').offsetTop == -50); // Auto vertical margins may.
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:50px; right:50px; margin-left:auto; margin-right:50px; width:500px; height:500px;"></div>
	//! </body></html>
}
test("auto left-margin, wide content")
{
	/* One auto horizontal margin may become negative if the other horizontal
	   margin isn't auto. */

	verify(document.getElementById('abs').offsetLeft == -200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0;">
	//!   <div id="abs" style="position:absolute; left:50px; right:50px; margin-left:50px; margin-right:auto; width:500px; height:500px;"></div>
	//! </body></html>
}
test("auto right-margin, wide content")
{
	/* One auto horizontal margin may become negative if the other horizontal
	   margin isn't auto. */

	verify(document.getElementById('abs').offsetLeft == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0; direction:rtl;">
	//!   <div id="abs" style="position:absolute; left:50px; right:50px; margin-left:auto; margin-right:50px; width:500px; height:500px;"></div>
	//! </body></html>
}
test("auto left-margin, wide content, RTL")
{
	/* One auto horizontal margin may become negative if the other horizontal
	   margin isn't auto. */

	verify(document.getElementById('abs').offsetLeft == -200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="position:relative; width:400px; height:400px; margin:0; direction:rtl;">
	//!   <div id="abs" style="position:absolute; left:50px; right:50px; margin-left:50px; margin-right:auto; width:500px; height:500px;"></div>
	//! </body></html>
}
test("auto right-margin, wide content, RTL")
{
	/* One auto horizontal margin may become negative if the other horizontal
	   margin isn't auto. */

	verify(document.getElementById('abs').offsetLeft == 100);
}

language c++;

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:block; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned block")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="position:absolute; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in absolute-positioned block")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="float:left; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned float")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:list-item; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned list-item")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:inline; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned inline")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:inline-block; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned inline-block")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:inline-table; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned inline-table")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:table; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned table")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:table"> <!-- we seem to be unable to insert a
	//!                                   table around loose table-captions, so
	//!                                   here's a little help. -->
	//!   <div style="display:table-caption; position:relative;">
	//!    <div id="elm" style="float:left;">&nbsp;</div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned table-caption")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:table-row-group; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned table-row-group")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:table-row; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned table-row")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:table-cell; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned table-cell")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:run-in; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! </body></html>
}
test("Float in positioned block run-in")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head>
	//! </head><body style="margin:0;">
	//!  <div style="display:run-in; position:relative;">
	//!   <div id="elm" style="float:left;">&nbsp;</div>
	//!  </div>
	//! <div></div>
	//! </body></html>
}
test("Float in positioned inline run-in")
{
	FramesDocument* doc = state.doc;
	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	IntersectionObject intersection(doc, LayoutCoord(0), LayoutCoord(0), FALSE);

	intersection.Traverse(doc->GetDocRoot());
	verify(!intersection.IsOutOfMemory());

	Box* inner_box = intersection.GetInnerBox();
	verify(inner_box);

	verify(inner_box->GetHtmlElement() == elm);
}
