/* -*- mode: c++; tab-width: 4; c-basic-offset: 4 -*- */

group "layout.tables-anon";

require init;

include "modules/doc/frm_doc.h";
include "modules/dochand/fdelm.h";
include "modules/layout/box/box.h";
include "modules/layout/box/tables.h";
include "modules/logdoc/htm_elm.h";

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm" style="display:table-cell;"></div>
	//! </body></html>
}
test("basic table-cell")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! <div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table-cell + box-less text node + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc()->Type() == Markup::HTE_TEXT);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! text
	//! <div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table-cell + text box + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent1 = elm1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRow());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRowGroup());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->GetTableContent());

	verify(parent1->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRow());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	verify(parent2->Parent()->Type() == Markup::HTE_BODY);

	verify(parent1->Suc());
	verify(parent1->Suc()->Type() == Markup::HTE_TEXT);
	verify(parent1->Suc()->Suc());
	verify(parent1->Suc()->Suc() == parent2);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><script>/*suspend parsing, trigger reflow*/document.body.offsetLeft;</script><div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table-cell + script + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc()->Type() == Markup::HTE_SCRIPT);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("block->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("table-cell + block->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("block->table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("table-cell + block->table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:none;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("none->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:none;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("table-cell + none->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:none;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("none->table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:none;"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("table-cell + none->table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  document.body.appendChild(new_elm);
	//!  new_elm.setAttribute('id', 'elm1');
	//!  new_elm.setAttribute('style', 'display:table-cell');
	//! </script>
	//! </body></html>
}
test("DOM-inserted table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  document.body.insertBefore(new_elm, document.getElementById('elm1').nextSibling);
	//!  new_elm.setAttribute('id', 'elm2');
	//!  new_elm.setAttribute('style', 'display:table-cell');
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-inserted table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  document.body.insertBefore(new_elm, document.getElementById('elm2'));
	//!  new_elm.setAttribute('id', 'elm1');
	//!  new_elm.setAttribute('style', 'display:table-cell');
	//! </script>
	//! </body></html>
}
test("DOM-inserted table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  document.body.insertBefore(new_elm, document.getElementById('elm3'));
	//!  new_elm.setAttribute('id', 'elm2');
	//!  new_elm.setAttribute('style', 'display:table-cell');
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-inserted table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'block';
	//! </script>
	//! </body></html>
}
test("table-cell->block")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsBlockBox());

	HTML_Element* parent = elm1->Parent();

	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'block';
	//! </script>
	//! </body></html>
}
test("table-cell + table-cell->block")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);

	verify(elm2->Parent() == parent->Parent());
	verify(elm2->Pred());
	verify(elm2->Pred() == parent);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'block';
	//! </script>
	//! </body></html>
}
test("table-cell->block + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsBlockBox());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);

	verify(elm1->Parent() == parent->Parent());
	verify(elm1->Suc());
	verify(elm1->Suc() == parent);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'block';
	//! </script>
	//! </body></html>
}
test("table-cell + table-cell->block + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	HTML_Element* parent1 = elm1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRow());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRowGroup());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->GetTableContent());

	verify(parent1->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* parent3 = elm3->Parent();
	verify(parent3->GetLayoutBox()->IsTableRow());

	parent3 = parent3->Parent();
	verify(parent3->GetLayoutBox()->IsTableRowGroup());

	parent3 = parent3->Parent();
	verify(parent3->GetLayoutBox()->GetTableContent());

	verify(parent3->Parent()->Type() == Markup::HTE_BODY);

	verify(elm2->Parent() == parent1->Parent());

	verify(parent1->Suc());
	verify(parent1->Suc() == elm2);
	verify(parent1->Suc()->Suc());
	verify(parent1->Suc()->Suc() == parent3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'none';
	//! </script>
	//! </body></html>
}
test("table-cell->none")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(!elm1->GetLayoutBox());

	HTML_Element* parent = elm1->Parent();

	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'none';
	//! </script>
	//! </body></html>
}
test("table-cell + table-cell->none")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(!elm2->GetLayoutBox());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);

	/* Cannot test who's elm2's relatives.
	   Who cares if the display:none element is inside the anonymous table or not... */
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'none';
	//! </script>
	//! </body></html>
}
test("table-cell->none + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(!elm1->GetLayoutBox());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);

	/* Cannot test who's elm1's relatives.
	   Who cares if the display:none element is inside the anonymous table or not... */
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'none';
	//! </script>
	//! </body></html>
}
test("table-cell + table-cell->none + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(!elm2->GetLayoutBox());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm2);
	verify(elm1->Suc()->Suc());
	verify(elm1->Suc()->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2"></div><div style="display:table-cell; content:'.';"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm2').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("block->table-cell + table-cell with generated content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(!cell1->FirstChild());
	verify(cell1 == elm2);

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->Suc());

	HTML_Element* generated_content = cell2->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm3::before { content:"."; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2"></div><div id="elm3" style="display:table-cell;"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm2').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("block->table-cell + table-cell with ::before")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(!cell1->FirstChild());
	verify(cell1 == elm2);

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->Suc());
	verify(cell2 == elm3);

	HTML_Element* before_pseudo = cell2->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());
	verify(!before_pseudo->Suc());

	HTML_Element* generated_content = before_pseudo->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm3::after { content:"."; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2"></div><div id="elm3" style="display:table-cell;"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm2').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("block->table-cell + table-cell with ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(!cell1->FirstChild());
	verify(cell1 == elm2);

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->Suc());
	verify(cell2 == elm3);

	HTML_Element* after_pseudo = cell2->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineContent());
	verify(!after_pseudo->Pred());

	HTML_Element* generated_content = after_pseudo->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2" style="display:table-cell; content:'.';"></div><div id="elm3"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm3').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("table-cell with generated content + block->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(cell1 == elm2);

	HTML_Element* generated_content = cell1->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->FirstChild());
	verify(!cell2->Suc());
	verify(cell2 == elm3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm2::before { content:"."; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2" style="display:table-cell;"></div><div id="elm3"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm3').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("table-cell with ::before + block->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(cell1 == elm2);

	HTML_Element* before_pseudo = cell1->FirstChild();
	verify(before_pseudo);
	verify(before_pseudo->GetIsBeforePseudoElement());
	verify(before_pseudo->GetLayoutBox());
	verify(before_pseudo->GetLayoutBox()->IsInlineContent());
	verify(!before_pseudo->Suc());

	HTML_Element* generated_content = before_pseudo->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->FirstChild());
	verify(!cell2->Suc());
	verify(cell2 == elm3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm2::after { content:"."; }
	//! </style></head><body style="margin:0;">
	//!  <div id="elm1"><div id="elm2" style="display:table-cell;"></div><div id="elm3"></div></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow
	//!   document.getElementById('elm3').style.display = 'table-cell';
	//!  </script>
	//! </body></html>
}
test("table-cell with ::after + block->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);

	HTML_Element* table = elm1->FirstChild();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());
	verify(!table->Suc());

	HTML_Element* table_row_group = table->FirstChild();
	verify(table_row_group);
	verify(table_row_group->GetLayoutBox());
	verify(table_row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!table_row_group->Suc());

	HTML_Element* table_row = table_row_group->FirstChild();
	verify(table_row);
	verify(table_row->GetLayoutBox());
	verify(table_row->GetLayoutBox()->IsTableRow());
	verify(!table_row->Suc());

	HTML_Element* cell1 = table_row->FirstChild();
	verify(cell1);
	verify(cell1->GetLayoutBox());
	verify(cell1->GetLayoutBox()->IsTableCell());
	verify(cell1 == elm2);

	HTML_Element* after_pseudo = cell1->LastChild();
	verify(after_pseudo);
	verify(after_pseudo->GetIsAfterPseudoElement());
	verify(after_pseudo->GetLayoutBox());
	verify(after_pseudo->GetLayoutBox()->IsInlineContent());
	verify(!after_pseudo->Pred());

	HTML_Element* generated_content = after_pseudo->FirstChild();
	verify(generated_content);
	verify(generated_content->GetLayoutBox());
	verify(generated_content->GetLayoutBox()->IsTextBox());
	verify(!generated_content->Suc());

	HTML_Element* cell2 = cell1->Suc();
	verify(cell2);
	verify(cell2->GetLayoutBox());
	verify(cell2->GetLayoutBox()->IsTableCell());
	verify(!cell2->FirstChild());
	verify(!cell2->Suc());
	verify(cell2 == elm3);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <table id="elm" style="content:'hest'"></table>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm').appendChild(document.createTextNode('FAIL'));
	//! </script>
	//! </body></html>
}
test("table with generated content + DOM-inserted node")
{
	// This test is inspired by bug CORE-36491

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetTableContent());

	HTML_Element* child = elm->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TBODY);
	verify(child->GetLayoutBox());

	HTML_Element* sibling = child->Suc();
	verify(sibling);
	verify(sibling->GetInserted() == HE_INSERTED_BYPASSING_PARSER);
	verify(!sibling->GetLayoutBox());
	verify(!sibling->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TR);
	verify(child->GetLayoutBox());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TD);
	verify(child->GetLayoutBox());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TEXT);
	verify(child->GetLayoutBox());
	verify(!child->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <table id="elm" style="content:'hest'"><thead id="dummy" style="display:none;"></thead></table>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var elm = document.getElementById('elm');
	//!  var dummy = document.getElementById('dummy');
	//!  elm.insertBefore(document.createTextNode('FAIL'), dummy);
	//!  elm.removeChild(dummy);
	//! </script>
	//! </body></html>
}
test("table with DOM-inserted node + generated content")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetTableContent());

	HTML_Element* child = elm->LastChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TBODY);
	verify(child->GetLayoutBox());

	HTML_Element* sibling = child->Pred();
	verify(sibling);
	verify(sibling->GetInserted() == HE_INSERTED_BYPASSING_PARSER);
	verify(!sibling->GetLayoutBox());
	verify(!sibling->Pred());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TR);
	verify(child->GetLayoutBox());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TD);
	verify(child->GetLayoutBox());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->Type() == Markup::HTE_TEXT);
	verify(child->GetLayoutBox());
	verify(!child->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm1'));
	//! </script>
	//! </body></html>
}
test("DOM-removed table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(!elm1);

	HTML_Element* body = state.doc->GetLogicalDocument()->GetBodyElm();
	verify(body);
	verify(body->GetLayoutBox());

	for (HTML_Element* elm = body->Next(); elm; elm = elm->Next())
		verify(!elm->GetLayoutBox() || elm->GetLayoutBox()->IsNoDisplayBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm2'));
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-removed table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(!elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm1'));
	//! </script>
	//! </body></html>
}
test("DOM-removed table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(!elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-cell;"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm2'));
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-removed table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(!elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm1'));
	//! </script>
	//! </body></html>
}
test("DOM-removed block")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(!elm1);

	HTML_Element* body = state.doc->GetLogicalDocument()->GetBodyElm();
	verify(body);
	verify(body->GetLayoutBox());

	for (HTML_Element* elm = body->Next(); elm; elm = elm->Next())
		verify(!elm->GetLayoutBox() || elm->GetLayoutBox()->IsNoDisplayBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm2'));
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-removed block")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(!elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1"></div><div id="elm2" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm1'));
	//! </script>
	//! </body></html>
}
test("DOM-removed block + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(!elm1);

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2"></div><div id="elm3" style="display:table-cell;"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.body.removeChild(document.getElementById('elm2'));
	//! </script>
	//! </body></html>
}
test("table-cell + DOM-removed block + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(!elm2);

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm1->Suc());
	verify(elm1->Suc() == elm3);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html style="display:table-cell;">
	//!  <body>
	//!   <script>
	//!    document.body.offsetLeft; // force reflow
	//!    document.removeChild(document.documentElement);
	//!   </script>
	//!  </body>
	//! </html>
}
test("DOM-removed root element with display:table-cell")
{
	// This test is inspired by bug CORE-36459
	// PASS if we didn't crash.
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"></span>
	//! </body>
	//! </html>
}
test("::before")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"></span>
	//! </body>
	//! </html>
}
test("::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_after = elm->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"></span>
	//! </body>
	//! </html>
}
test("::before + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(elm_after->Pred() == elm->FirstChild());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm">x</span>
	//! </body>
	//! </html>
}
test("::before + content")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	verify(elm_before->Suc());
	verify(elm_before->Suc()->GetLayoutBox());
	verify(elm_before->Suc()->GetLayoutBox()->IsTextBox());
	verify(!elm_before->Suc()->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm">x</span>
	//! </body>
	//! </html>
}
test("content + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(elm_after->Pred());
	verify(elm_after->Pred()->GetLayoutBox());
	verify(elm_after->Pred()->GetLayoutBox()->IsTextBox());
	verify(!elm_after->Pred()->Pred());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm">x</span>
	//! </body>
	//! </html>
}
test("::before + content + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(elm_after->Pred());
	verify(elm_after->Pred()->GetLayoutBox());
	verify(elm_after->Pred()->GetLayoutBox()->IsTextBox());
	verify(elm_after->Pred()->Pred());
	verify(elm_after->Pred()->Pred() == elm->FirstChild());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span style="display:table-cell;"></span></span>
	//! </body>
	//! </html>
}
test("::before + table-cell")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_before->Suc();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());
	verify(!elm_child->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span style="display:table-cell;"></span></span>
	//! </body>
	//! </html>
}
test("table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_after->Pred();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());
	verify(!elm_child->Pred());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span style="display:table-cell;"></span></span>
	//! </body>
	//! </html>
}
test("::before + table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_before->Suc();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm_child->Suc();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());
	verify(!elm_after->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var elm = document.getElementById('elm');
	//!  var new_elm = document.createElement('span');
	//!  elm.appendChild(new_elm);
	//!  new_elm.setAttribute('style', 'display:table-cell');
	//! </script>
	//! </body>
	//! </html>
}
test("::before + DOM-inserted table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_before->Suc();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm_child->Suc();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());
	verify(!elm_after->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span id="elm2" style="display:none;"></span></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body>
	//! </html>
}
test("::before + none->table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_before->Suc();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm_child->Suc();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());
	verify(!elm_after->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span id="elm2" style="display:block;"></span></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//! </script>
	//! </body>
	//! </html>
}
test("::before + block->table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_child = elm_before->Suc();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsInlineBox());
	verify(elm_child->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm_child->Suc();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());
	verify(!elm_after->Suc());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRowGroup());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableRow());

	elm_child = elm_child->FirstChild();
	verify(elm_child);
	verify(elm_child->GetLayoutBox());
	verify(elm_child->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span id="elm2" style="display:table-cell;"></span></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  elm.removeChild(document.getElementById('elm2'));
	//! </script>
	//! </body>
	//! </html>
}
test("::before + DOM-removed table-cell + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(elm_after->Pred() == elm->FirstChild());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span id="elm2" style="display:table-cell;"></span></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'none';
	//! </script>
	//! </body>
	//! </html>
}
test("::before + table-cell->none + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(elm_before->Suc());
	verify(!elm_before->Suc()->GetLayoutBox());
	verify(elm_before->Suc()->Suc() == elm_after);

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm::before, #elm::after { display:table-cell; content:""; }
	//! </style></head>
	//! <body>
	//! <span id="elm"><span id="elm2" style="display:table-cell;"></span></span>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'block';
	//! </script>
	//! </body>
	//! </html>
}
test("::before + table-cell->block + ::after")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->Parent()->Type() == Markup::HTE_BODY);

	HTML_Element* elm_before = elm->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsInlineBox());
	verify(elm_before->GetLayoutBox()->GetTableContent());

	HTML_Element* block = elm_before->Suc();
	verify(block);
	verify(block->GetLayoutBox());
	verify(block->GetLayoutBox()->IsBlockBox());
	verify(block->GetLayoutBox()->GetContainer());

	HTML_Element* elm_after = elm->LastChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsInlineBox());
	verify(elm_after->GetLayoutBox()->GetTableContent());

	verify(block->Suc() == elm_after);

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRowGroup());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableRow());

	elm_before = elm_before->FirstChild();
	verify(elm_before);
	verify(elm_before->GetIsBeforePseudoElement());
	verify(elm_before->GetLayoutBox());
	verify(elm_before->GetLayoutBox()->IsTableCell());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRowGroup());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableRow());

	elm_after = elm_after->FirstChild();
	verify(elm_after);
	verify(elm_after->GetIsAfterPseudoElement());
	verify(elm_after->GetLayoutBox());
	verify(elm_after->GetLayoutBox()->IsTableCell());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetIsBeforePseudoElement());
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetIsAfterPseudoElement());
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetIsBeforePseudoElement());
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsInlineBox());

	HTML_Element* after = before->Suc();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent() == elm1);

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetIsBeforePseudoElement());
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsInlineBox());
	verify(before->Suc() == elm2);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent() == elm1);

	HTML_Element* after = elm1->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsInlineBox());
	verify(after->Pred() == elm2);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before + content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent() == elm1);

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetIsBeforePseudoElement());
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsInlineBox());
	verify(before->Suc() == elm2);

	HTML_Element* after = elm1->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsInlineBox());
	verify(after->Pred() == elm2);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->GetTableContent());
	verify(!before->Suc());

	HTML_Element* child = before->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsBeforePseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::after table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* after = elm1->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->GetTableContent());
	verify(!after->Suc());

	HTML_Element* child = after->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsAfterPseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before table-cell + ::after table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->GetTableContent());

	HTML_Element* after = elm1->LastChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->GetTableContent());
	verify(after->Pred() == before);

	HTML_Element* child = before->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsBeforePseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	child = after->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsAfterPseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before table-cell + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());
	verify(!elm2->Suc());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->GetTableContent());
	verify(before->Suc() == elm2);

	HTML_Element* child = before->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsBeforePseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with content + ::after table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());
	verify(!elm2->Pred());

	HTML_Element* after = elm1->LastChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->GetTableContent());
	verify(after->Pred() == elm2);

	HTML_Element* child = after->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsAfterPseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { display:table-cell; content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-cell with ::before table-cell + content + ::after tbl-c")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->GetTableContent());
	verify(before->Suc() == elm2);

	HTML_Element* after = elm1->LastChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->GetTableContent());
	verify(after->Pred() == elm2);

	HTML_Element* child = before->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsBeforePseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	child = after->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRowGroup());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetIsAfterPseudoElement());
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());
	verify(!child->Suc());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTextBox());
	verify(!child->Suc());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm" style="display:table-row;"></div>
	//! </body></html>
}
test("basic table-row 1")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	verify(!elm->FirstChild());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm" style="display:table-row;"><div></div></div>
	//! </body></html>
}
test("basic table-row 2")
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	HTML_Element* child = elm->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsBlockBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;">x<div id="elm2" style="display:table-cell;"></div></div>
	//! </body></html>
}
test("table-row with text + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* child = elm1->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	child = child->Suc();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	verify(child == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;"><div id="elm2" style="display:table-cell;"></div>x</div>
	//! </body></html>
}
test("table-row with table-cell + text")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* child = elm1->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	verify(child == elm2);

	child = child->Suc();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row-group;">x<div id="elm2" style="display:table-cell;"></div></div>
	//! </body></html>
}
test("table-row-group with text + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* child = elm1->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	child = child->Suc();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	verify(child == elm2);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row-group;"><div id="elm2" style="display:table-cell;"></div>x</div>
	//! </body></html>
}
test("table-row-group with table-cell + text")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* child = elm1->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableRow());

	child = child->FirstChild();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	verify(child == elm2);

	child = child->Suc();
	verify(child);
	verify(child->GetLayoutBox());
	verify(child->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;"></div><div id="elm2" style="display:table-row;"></div>
	//! </body></html>
}
test("table-row + table-row")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	verify(!elm1->FirstChild());
	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;"></div><div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table-row + table-cell")
disabled; // Fails because of bug CORE-23691
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	verify(!elm1->FirstChild());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	verify(parent->Pred() == elm1);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-row;"></div>
	//! </body></html>
}
test("table-cell + table-row")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	verify(parent->Suc() == elm2);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row-group;"></div><div id="elm2" style="display:table-row;"></div>
	//! </body></html>
}
test("table-row-group + table-row")
disabled; // Fails because of bug CORE-23691
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	verify(!elm2->FirstChild());
	verify(elm2->Parent() == elm1);

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;"></div><div id="elm2" style="display:table-row-group;"></div>
	//! </body></html>
}
test("table-row + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());
	verify(!elm1->FirstChild());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRowGroup());
	verify(!elm2->FirstChild());

	HTML_Element* parent1 = elm1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRowGroup());
	verify(parent1->Suc() == elm2);

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->GetTableContent());
	verify(parent1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"></div>
	//! </body>
	//! </html>
}
test("table-row with ::before")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"></div>
	//! </body>
	//! </html>
}
test("table-row with ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* after = elm1->FirstChild();
	verify(after);
	verify(after->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"></div>
	//! </body>
	//! </html>
}
test("table-row with ::before + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	HTML_Element* after = before->Suc();
	verify(after);
	verify(after->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row with ::before + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Pred();
	verify(before);
	verify(before->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row with content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent() == elm1);

	HTML_Element* after = elm2->Parent()->Suc();
	verify(after);
	verify(after->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row with ::before + content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Pred();
	verify(before);
	verify(before->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	HTML_Element* after = elm2->Parent()->Suc();
	verify(after);
	verify(after->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row-group;"></div><div id="elm2" style="display:table-row-group;"></div>
	//! </body></html>
}
test("table-row-group + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRowGroup());

	verify(!elm1->FirstChild());
	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-row-group;"></div>
	//! </body></html>
}
test("table-cell + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRowGroup());

	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	verify(parent->Suc() == elm2);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"></div>
	//! </body>
	//! </html>
}
test("table-row-group with ::before")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"></div>
	//! </body>
	//! </html>
}
test("table-row-group with ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after = elm1->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"></div>
	//! </body>
	//! </html>
}
test("table-row-group with ::before + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	HTML_Element* after = before->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row-group with ::before + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Parent()->Pred();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row-group with content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent() == elm1);

	HTML_Element* after = elm2->Parent()->Parent()->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table-row-group;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table-row-group with ::before + content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Parent()->Pred();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	HTML_Element* after = elm2->Parent()->Parent()->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"></div><div id="elm2" style="display:table;"></div>
	//! </body></html>
}
test("table + table")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->GetTableContent());

	verify(!elm1->FirstChild());
	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table;"></div>
	//! </body></html>
}
test("table-cell + table")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->GetTableContent());

	verify(!elm2->FirstChild());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Suc() == elm2);

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"></div>
	//! </body>
	//! </html>
}
test("table with ::before")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRowGroup());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"></div>
	//! </body>
	//! </html>
}
test("table with ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* after = elm1->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRowGroup());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"></div>
	//! </body>
	//! </html>
}
test("table with ::before + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* before = elm1->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* after = before->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRowGroup());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table with ::before + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Parent()->Parent()->Pred();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRowGroup());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table with content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent()->Parent() == elm1);

	HTML_Element* after = elm2->Parent()->Parent()->Parent()->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRowGroup());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <head><style>
	//!  #elm1::before, #elm1::after { content:"x"; }
	//! </style></head>
	//! <body>
	//! <div id="elm1" style="display:table;"><div id="elm2">x</div></div>
	//! </body>
	//! </html>
}
test("table with ::before + content + ::after")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());

	verify(elm2->Parent()->GetLayoutBox()->IsTableCell());
	verify(elm2->Parent()->Parent()->Parent()->Parent() == elm1);

	HTML_Element* before = elm2->Parent()->Parent()->Parent()->Pred();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRowGroup());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableRow());

	before = before->FirstChild();
	verify(before);
	verify(before->GetLayoutBox());
	verify(before->GetLayoutBox()->IsTableCell());

	verify(before->FirstChild());
	verify(before->FirstChild()->GetIsBeforePseudoElement());
	verify(before->FirstChild()->GetLayoutBox());
	verify(before->FirstChild()->GetLayoutBox()->IsInlineBox());

	HTML_Element* after = elm2->Parent()->Parent()->Parent()->Suc();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRowGroup());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableRow());

	after = after->FirstChild();
	verify(after);
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->IsTableCell());

	verify(after->FirstChild());
	verify(after->FirstChild()->GetIsAfterPseudoElement());
	verify(after->FirstChild()->GetLayoutBox());
	verify(after->FirstChild()->GetLayoutBox()->IsInlineBox());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-row;">x</div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm2').style.display = 'block';
	//! </script>
	//! </body></html>
}
test("table-cell + table-row->block")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
	verify(elm2->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-row;"></div><div id="elm3"></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm3').style.display = 'table-row';
	//! </script>
	//! </body></html>
}
test("table-cell + table-row + block->table-row")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableRow());

	HTML_Element* parent1 = elm1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRow());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRowGroup());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->GetTableContent());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	HTML_Element* parent3 = elm3->Parent();
	verify(parent3->GetLayoutBox()->IsTableRowGroup());

	parent3 = parent3->Parent();
	verify(parent3->GetLayoutBox()->GetTableContent());

	verify(parent1 == parent2);
	verify(parent1 == parent3);

	verify(parent1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"></div><div id="elm2" style="display:table-row;"></div><div id="elm3" style="display:table-row-group;"></div>
	//! </body></html>
}
test("table-cell + table-row + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* parent1 = elm1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRow());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->IsTableRowGroup());

	parent1 = parent1->Parent();
	verify(parent1->GetLayoutBox()->GetTableContent());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	HTML_Element* parent3 = elm3->Parent();
	verify(parent3->GetLayoutBox()->GetTableContent());

	verify(parent1 == parent2);
	verify(parent1 == parent3);

	verify(parent1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"></div><div id="elm2" style="display:table-row-group;"></div>
	//! </body></html>
}
test("table + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	verify(elm1->Suc() == parent2);

	verify(elm1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"></div><div id="elm2" style="display:table-row;"></div>
	//! </body></html>
}
test("table + table-row")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	verify(elm1->Suc() == parent2);

	verify(elm1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"></div><div id="elm2" style="display:table-cell;"></div>
	//! </body></html>
}
test("table + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRow());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	verify(elm1->Suc() == parent2);

	verify(elm1->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-row;"><div id="elm2" style="display:table-row-group;"></div></div>
	//! </body></html>
}
test("table-row with table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableRow());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* parent2 = elm2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->IsTableCell());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRow());
	verify(parent2 == elm1);

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->IsTableRowGroup());

	parent2 = parent2->Parent();
	verify(parent2->GetLayoutBox()->GetTableContent());

	verify(parent2->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2" style="display:table-row;"></div><div id="elm3" style="display:table-row-group;"></div></div>
	//! </body></html>
}
test("table-cell with table-row + table-row-group")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableRow());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Suc();
	verify(parent == elm3);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2" style="display:table-cell;"></div><div id="elm3" style="display:table-row;"></div></div>
	//! </body></html>
}
test("table with table-cell + table-row")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableRow());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Suc();
	verify(parent == elm3);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2" style="display:table;"></div><div id="elm3" style="display:table-cell;"></div></div>
	//! </body></html>
}
test("table with table + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->GetTableContent());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Suc();
	verify(parent == elm3);

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2" style="display:table;"></div><div id="elm3" style="display:table;"></div></div>
	//! </body></html>
}
test("table with table + table")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->GetTableContent());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->GetTableContent());

	verify(elm2->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm3"></div></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  var elm1 = document.getElementById('elm1');
	//!  elm1.insertBefore(new_elm, elm1.firstChild);
	//!  new_elm.setAttribute('id', 'elm2');
	//! </script>
	//! </body></html>
}
test("table with DOM-inserted content + content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsBlockBox());
	verify(elm3->GetLayoutBox()->GetContainer());

	verify(elm2->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2"></div></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  var elm1 = document.getElementById('elm1');
	//!  elm1.appendChild(new_elm);
	//!  new_elm.setAttribute('id', 'elm3');
	//! </script>
	//! </body></html>
}
test("table with content + DOM-inserted content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsBlockBox());
	verify(elm3->GetLayoutBox()->GetContainer());

	verify(elm2->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"> <div id="elm3"></div></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  var elm1 = document.getElementById('elm1');
	//!  elm1.insertBefore(new_elm, elm1.firstChild);
	//!  new_elm.setAttribute('id', 'elm2');
	//! </script>
	//! </body></html>
}
test("table with DOM-inserted content + whitespace + content")
{
	// This test is inspired by bug CORE-20907

	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsBlockBox());
	verify(elm3->GetLayoutBox()->GetContainer());

	verify(elm2->Suc());
	verify(elm2->Suc()->Type() == Markup::HTE_TEXT);
	verify(elm2->Suc()->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2"></div> </div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  var new_elm = document.createElement('div');
	//!  var elm1 = document.getElementById('elm1');
	//!  elm1.appendChild(new_elm);
	//!  new_elm.setAttribute('id', 'elm3');
	//! </script>
	//! </body></html>
}
test("table with content + whitespace + DOM-inserted content")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->GetTableContent());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsBlockBox());
	verify(elm2->GetLayoutBox()->GetContainer());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsBlockBox());
	verify(elm3->GetLayoutBox()->GetContainer());

	verify(elm2->Suc());
	verify(elm2->Suc()->Type() == Markup::HTE_TEXT);
	verify(elm2->Suc()->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table-cell;"><div id="elm2" style="display:table-cell;"></div><div id="elm3" style="display:table-cell;"></div></div>
	//! </body></html>
}
test("table-cell with table-cell + table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm2->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <div id="elm1" style="display:table;"><div id="elm2" style="display:table;"></div><div id="elm3" style="display:table;"></div></div>
	//! <script>
	//!  document.body.offsetLeft; // force reflow
	//!  document.getElementById('elm1').style.display = 'table-cell';
	//!  document.getElementById('elm2').style.display = 'table-cell';
	//!  document.getElementById('elm3').style.display = 'table-cell';
	//! </script>
	//! </body></html>
}
test("table->table-cell with table->table-cell + table->table-cell")
{
	HTML_Element* elm1 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm1"));
	verify(elm1);
	verify(elm1->GetLayoutBox());
	verify(elm1->GetLayoutBox()->IsTableCell());

	HTML_Element* elm2 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm2"));
	verify(elm2);
	verify(elm2->GetLayoutBox());
	verify(elm2->GetLayoutBox()->IsTableCell());

	HTML_Element* elm3 = state.doc->GetDocRoot()->GetElmById(UNI_L("elm3"));
	verify(elm3);
	verify(elm3->GetLayoutBox());
	verify(elm3->GetLayoutBox()->IsTableCell());

	verify(elm2->Suc() == elm3);

	HTML_Element* parent = elm2->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent == elm1);

	parent = elm1->Parent();
	verify(parent->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	verify(parent->Parent()->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//! <body>
	//! <div style="display:table;">
	//!  <div style="display:table-row-group;">
	//!   <div id="elm" style="display:none;"></div>
	//!   <div style="display:table-row;"></div>
	//!  </div>
	//! </div>
	//! <script>
	//!  document.body.offsetLeft;
	//!  document.getElementById('elm').style.display='block';
	//! </script>
	//! </body></html>
}
test("none->table-row + table-row")
{
	// This test is inspired by bug CORE-24599

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* parent = elm->Parent();
	verify(parent->GetLayoutBox()->IsTableCell());

	parent = parent->Parent();
	verify(parent->GetInserted() == HE_INSERTED_BY_LAYOUT);
	verify(parent->GetLayoutBox()->IsTableRow());

	verify(parent->Suc());
	verify(parent->Suc()->GetLayoutBox());
	verify(parent->Suc()->GetLayoutBox()->IsTableRow());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->IsTableRowGroup());

	parent = parent->Parent();
	verify(parent->GetLayoutBox()->GetTableContent());

	parent = parent->Parent();
	verify(parent->Type() == Markup::HTE_BODY);
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:after { content:"."; }
	//! </style></head><body>
	//!  <div id="elm">
	//!   <div style="display:table-row-group;"></div>
	//!   <script>document.body.offsetLeft;</script>
	//!   <br>
	//!  </div>
	//! </body></html>
}
test("block with ::after and table-row-group, suspend, element")
{
	/* This test is inspired by crash bug CORE-27808, and if we get here, it
	   didn't crash. But let's examine the tree a little as well. */

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after = elm->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->FirstChild());
	verify(after->FirstChild()->GetLayoutBox());

	verify(after->Pred()); // whitespace text node
	verify(after->Pred()->Pred()->Pred());
	verify(after->Pred()->Pred()->Type() == Markup::HTE_BR);
	verify(after->Pred()->Pred()->GetLayoutBox());

	verify(elm->FirstChild());

	HTML_Element* table = elm->FirstChild()->Suc();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());

	HTML_Element* row_group = table->FirstChild();
	verify(row_group);
	verify(row_group->GetLayoutBox());
	verify(row_group->GetLayoutBox()->IsTableRowGroup());

	verify(!row_group->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:after { content:"."; }
	//! </style></head><body>
	//!  <div id="elm">
	//!   <div style="display:table-row;"></div>
	//!   <script>document.body.offsetLeft;</script>
	//!   <br>
	//!  </div>
	//! </body></html>
}
test("block with ::after and table-row, suspend, element")
{
	/* This test is inspired by crash bug CORE-27808, and if we get here, it
	   didn't crash. But let's examine the tree a little as well. */

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after = elm->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->FirstChild());
	verify(after->FirstChild()->GetLayoutBox());

	verify(after->Pred()); // whitespace text node
	verify(after->Pred()->Pred()->Pred());
	verify(after->Pred()->Pred()->Type() == Markup::HTE_BR);
	verify(after->Pred()->Pred()->GetLayoutBox());

	verify(elm->FirstChild());

	HTML_Element* table = elm->FirstChild()->Suc();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());

	HTML_Element* row_group = table->FirstChild();
	verify(row_group);
	verify(row_group->GetLayoutBox());
	verify(row_group->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* row = row_group->FirstChild();
	verify(row);
	verify(row->GetLayoutBox());
	verify(row->GetLayoutBox()->IsTableRow());

	verify(!row->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:after { content:"."; }
	//! </style></head><body>
	//!  <div id="elm">
	//!   <div style="display:table-cell;"></div>
	//!   <script>document.body.offsetLeft;</script>
	//!   <br>
	//!  </div>
	//! </body></html>
}
test("block with ::after and table-cell, suspend, element")
{
	/* This test is inspired by crash bug CORE-27808, and if we get here, it
	   didn't crash. But let's examine the tree a little as well. */

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after = elm->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->FirstChild());
	verify(after->FirstChild()->GetLayoutBox());

	verify(after->Pred()); // whitespace text node
	verify(after->Pred()->Pred()->Pred());
	verify(after->Pred()->Pred()->Type() == Markup::HTE_BR);
	verify(after->Pred()->Pred()->GetLayoutBox());

	verify(elm->FirstChild());

	HTML_Element* table = elm->FirstChild()->Suc();
	verify(table);
	verify(table->GetLayoutBox());
	verify(table->GetLayoutBox()->GetTableContent());

	HTML_Element* row_group = table->FirstChild();
	verify(row_group);
	verify(row_group->GetLayoutBox());
	verify(row_group->GetLayoutBox()->IsTableRowGroup());

	HTML_Element* row = row_group->FirstChild();
	verify(row);
	verify(row->GetLayoutBox());
	verify(row->GetLayoutBox()->IsTableRow());

	HTML_Element* cell = row->FirstChild();
	verify(cell);
	verify(cell->GetLayoutBox());
	verify(cell->GetLayoutBox()->IsTableCell());

	verify(!cell->FirstChild());
}

html
{
	//! <!DOCTYPE html>
	//! <html><head><style>
	//!  #elm:after { display:table; content:"." url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAAZQTFRFF0FBNl5edYJQRgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kMFQcuM+pK01QAAAAjSURBVDjLY2AAA/v/IPCBYZQ3yhs6PDD1/wBUdJQ3yhsyPABsMISno69NsgAAAABJRU5ErkJggg==); }
	//! </style></head><body>
	//!  <div id="elm"></div>
	//! </body></html>
}
test("::before as table with two pcs. of generated content")
{
	// Inspired by crash bug CORE-31697.

	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsBlockBox());

	HTML_Element* after = elm->LastChild();
	verify(after);
	verify(after->GetIsAfterPseudoElement());
	verify(after->GetLayoutBox());
	verify(after->GetLayoutBox()->GetTableContent());
	verify(!after->Pred());

	HTML_Element* row_group = after->FirstChild();
	verify(row_group);
	verify(row_group->GetLayoutBox());
	verify(row_group->GetLayoutBox()->IsTableRowGroup());
	verify(!row_group->Suc());

	HTML_Element* row = row_group->FirstChild();
	verify(row);
	verify(row->GetLayoutBox());
	verify(row->GetLayoutBox()->IsTableRow());
	verify(!row->Suc());

	HTML_Element* cell = row->FirstChild();
	verify(cell);
	verify(cell->GetLayoutBox());
	verify(cell->GetLayoutBox()->IsTableCell());
	verify(!cell->Suc());

	HTML_Element* text = cell->FirstChild();
	verify(text);
	verify(text->GetIsGeneratedContent());
	verify(text->GetLayoutBox());
	verify(text->GetLayoutBox()->IsTextBox());

	HTML_Element* image = text->Suc();
	verify(image);
	verify(image->GetIsGeneratedContent());
	verify(image->GetLayoutBox());
	verify(image->GetLayoutBox()->IsContentImage());

	verify(!image->Suc());
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <iframe src="data:text/html,%3C%21DOCTYPE%20html%3E%0D%0A%3Chtml%3E%3Cbody%3E%3Cdiv%20id%3D%22elm%22%20style%3D%22display%3Atable-row;%22%3E88888888%3Cdiv%20style%3D%22display%3Atable-cell;%22%3E%3C/div%3E%3C/div%3E%3C%2Fbody%3E%3C%2Fhtml%3E"></iframe>
	//! </body></html>
}
test("Markup::HTE_TEXTGROUP: Phone number text in table-row")
require PHONE2LINK_SUPPORT;
{
	/* Most of the HTML in this test is sadly obfuscated as a data: URI inside
	   an IFRAME. This is thanks to the fix for EMO-794, which prevents
	   PHONE2LINK_SUPPORT from working on opera: URLs, and html{} blocks in
	   selftests are in fact opera: URLs... */

	FramesDocElm* iframe_root = state.doc->GetIFrmRoot();
	verify(iframe_root);

	FramesDocElm* iframe = iframe_root->FirstChild();
	verify(iframe);

	FramesDocument* iframe_doc = iframe->GetCurrentDoc();
	verify(iframe_doc);

	HTML_Element* elm = iframe_doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->IsTableRow());

	TableRowBox* row = (TableRowBox*) elm->GetLayoutBox();
	TableCellBox* cell = row->GetFirstCell();
	verify(cell);
	verify(cell->GetHtmlElement()->GetInserted() == HE_INSERTED_BY_LAYOUT);

	// verify that we're actually testing something with Markup::HTE_TEXTGROUP here.

	verify(cell->GetHtmlElement()->FirstChild());
	verify(cell->GetHtmlElement()->FirstChild()->Type() == Markup::HTE_TEXTGROUP);

	cell = (TableCellBox*) cell->Suc();
	verify(cell);
	verify(cell->GetHtmlElement()->GetInserted() != HE_INSERTED_BY_LAYOUT);
	verify(!cell->Suc());
}
