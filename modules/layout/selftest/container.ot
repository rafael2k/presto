/* -*- mode: c++; tab-width: 4; c-basic-offset: 4 -*- */

group "layout.container";

require init;

include "modules/doc/frm_doc.h";
include "modules/dochand/win.h";
include "modules/layout/box/box.h";
include "modules/layout/content/scrollable.h";
include "modules/logdoc/htm_elm.h";
include "modules/pi/OpWindow.h";

language c++;

global
{
	// A couple of nasty methods to get and set window size.

	void GetWindowSize(Window* win, UINT32& width, UINT32& height)
	{
		win->GetOpWindow()->GetInnerSize(&width, &height);
	}

	BOOL SetWindowSize(Window* win, UINT32 width, UINT32 height)
	{
		/* First increase the window's maximum size, so we don't get
		   clamped. Note that there's no way to obtain the original maximum
		   size through the OpWindow API. */

		win->GetOpWindow()->SetMaximumInnerSize(width, height);

		win->GetOpWindow()->SetInnerSize(width, height);
		win->HandleNewWindowSize(width, height);
		return OpStatus::IsSuccess(win->GetCurrentDoc()->Reflow(FALSE));
	}
}

language ecmascript;

/* BlockContainer (from CORE-25081) */

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer" style="height: 0px">
//!       <div id="inner" style="height: 1%">
//! 	    &nbsp;
//!       </div>
//!     </div>
//!   </body>
//! </html>
//!
}
test("Height change 0->auto with % height child")
{
    document.getElementById('outer').style.height = 'auto';

    /* Now verify that the percentage height is evaluated to 'auto'
       and the height recomputed accordingly. */

    verify(document.getElementById('outer').offsetHeight > 0);
    verify(document.getElementById('inner').offsetHeight > 0);
}

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer">
//!       <div id="inner" style="height: 100%">
//! 	    &nbsp;
//!       </div>
//!     </div>
//!   </body>
//! </html>
//!
}
test("Height change auto->100px with % height child")
{
    document.getElementById('outer').style.height = '100px';

    /* Now verify that the percentage height is evaluated to 'non-auto'
       and the height recomputed accordingly. */

    verify(document.getElementById('outer').offsetHeight == 100);
    verify(document.getElementById('inner').offsetHeight == 100);
}

/* ShrinkToFitContainer */

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer" style="height: 0px; position:absolute">
//!       <div id="inner" style="height: 1%">
//! 	    &nbsp;
//!       </div>
//!     </div>
//!   </body>
//! </html>
}
test("Height change STF 0->auto with % height child")
{
    document.getElementById('outer').style.height = 'auto';

    /* Now verify that the percentage height is evaluated to 'auto'
       and the height recomputed accordingly. */

    verify(document.getElementById('outer').offsetHeight > 0);
    verify(document.getElementById('inner').offsetHeight > 0);
}

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer" style="position:absolute">
//!       <div id="inner" style="height:100%">
//! 	    &nbsp;
//!       </div>
//!     </div>
//!   </body>
//! </html>
}
test("Height change STF auto->100px with % height child")
{
    document.getElementById('outer').style.height = '100px';

    /* Now verify that the percentage height is evaluated to 'non-auto'
       and the height recomputed accordingly. */

    verify(document.getElementById('outer').offsetHeight == 100);
    verify(document.getElementById('inner').offsetHeight == 100);
}

/* TableContent */

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer" style="height: 0px">
//!       <table id="inner" style="height: 1%">
//! 	    <td>&nbsp;</td>
//!       </table>
//!     </div>
//!   </body>
//! </html>
}
test("Height change 0->auto with % height table")
{
    document.getElementById('outer').style.height = 'auto';

    /* Now verify that the percentage height is evaluated to 'auto'
       and the height recomputed accordingly.

       For table content, we store the old computed css height and
       compares the old and new computed height when we recompute the
       size of the table element. */

    verify(document.getElementById('outer').offsetHeight > 0);
    verify(document.getElementById('inner').offsetHeight > 0);
}

html
{
//! <!doctype html>
//! <html>
//!   <body>
//!     <div id="outer">
//!       <table id="inner" style="height:100%">
//! 	    <td>&nbsp;</td>
//!       </table>
//!     </div>
//!   </body>
//! </html>
}
test("Height change auto->100px with % height table")
{
    document.getElementById('outer').style.height = '100px';

    /* Now verify that the percentage height is evaluated to 'non-auto'
       and the height recomputed accordingly.

       For table content, we store the old computed css height and
       compare the old and new computed height when we recompute the
       size of the table element. */

    verify(document.getElementById('outer').offsetHeight == 100);
    verify(document.getElementById('inner').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//! <body style="position:relative; width:1000px;">
	//! <div id="stf" style="position:relative; float:left;">
	//!  <div style="float:left; width:300px;">
	//!   <div style="height:200px;"></div>
	//!   <b style="float:left; width:100px; height:50px;">
	//!    <i style="display:block;">
	//!   </b>
	//!   <b id="elm" style="clear:left; float:left; width:100px; height:50px;">
	//!    </i>
	//!   </b>
	//!  </div>
	//! </div>
	//! </body>
	//! </html>
}
test("Broken HTML, illegally terminated float")
{
	verify(document.getElementById('elm').offsetTop == 250);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px;">
	//!   <div style="width:200px; height:100px; float:left;"></div>
	//!   <table id="elm" cellspacing="0" cellpadding="0">
	//!    <tr>
	//!     <td>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!     </td>
	//!    </tr>
	//!   </table>
	//!  </div>
	//! </body></html>
}
test("Float and auto-width table beside")
{
	verify(document.getElementById('elm').offsetLeft == 200);
	verify(document.getElementById('elm').offsetTop == 0);
	verify(document.getElementById('elm').offsetWidth == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px;">
	//!   <div style="width:200px; height:100px; float:left;"></div>
	//!   <table id="elm" cellspacing="0" cellpadding="0">
	//!    <tr>
	//!     <td>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!     </td>
	//!    </tr>
	//!   </table>
	//!  </div>
	//! </body></html>
}
test("Float and auto-width table below")
{
	verify(document.getElementById('elm').offsetLeft == 0);
	verify(document.getElementById('elm').offsetTop == 100);
	verify(document.getElementById('elm').offsetWidth == 400);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px;">
	//!   <div style="width:200px; height:100px; float:left;"></div>
	//!   <table id="elm" cellspacing="0" cellpadding="0" style="overflow:hidden;">
	//!    <tr>
	//!     <td>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!      <div style="display:inline-block; width:50px; height:30px;"></div>
	//!     </td>
	//!    </tr>
	//!   </table>
	//!  </div>
	//! </body></html>
}
test("Float and auto-width table with overflow:hidden beside")
{
	verify(document.getElementById('elm').offsetLeft == 200);
	verify(document.getElementById('elm').offsetTop == 0);
	verify(document.getElementById('elm').offsetWidth == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px;">
	//!   <div style="width:200px; height:100px; float:left;"></div>
	//!   <table id="elm" cellspacing="0" cellpadding="0" style="overflow:hidden;">
	//!    <tr>
	//!     <td>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!      <div style="display:inline-block; width:250px; height:30px;"></div>
	//!     </td>
	//!    </tr>
	//!   </table>
	//!  </div>
	//! </body></html>
}
test("Float and auto-width table with overflow:hidden below")
{
	verify(document.getElementById('elm').offsetLeft == 0);
	verify(document.getElementById('elm').offsetTop == 100);
	verify(document.getElementById('elm').offsetWidth == 400);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px;">
	//!   <div style="width:200px; height:100px; float:left;"></div>
	//!   <div id="elm" style="overflow:hidden;">
	//!    <div style="display:inline-block; width:50px; height:30px;"></div>
	//!    <div style="display:inline-block; width:50px; height:30px;"></div>
	//!    <div style="display:inline-block; width:50px; height:30px;"></div>
	//!    <div style="display:inline-block; width:50px; height:30px;"></div>
	//!    <div style="display:inline-block; width:50px; height:30px;"></div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("Float and auto-width block with overflow:hidden beside")
{
	verify(document.getElementById('elm').offsetLeft == 200);
	verify(document.getElementById('elm').offsetTop == 0);
	verify(document.getElementById('elm').offsetWidth == 200);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="overflow:hidden; margin:9px;">
	//!  <div id="elm" style="margin:8px;"></div>
	//! </body></html>
}
test("overflow:hidden on BODY")
{
	/* Read http://www.w3.org/TR/CSS2/visufx.html#propdef-overflow and
	   http://www.w3.org/TR/CSS2/visuren.html#block-formatting - the
	   computed 'overflow' value of BODY ('hidden') will be propagated
	   to the viewport, the used value of BODY will be 'visible' and
	   no block formatting context will be established, which means
	   that the BODY and DIV top margins can collapse. */

	verify(document.getElementById('elm').offsetTop == 9);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:400px; padding-left:50px; direction:rtl;">
	//!   <div id="elm" style="overflow:hidden; height:30px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:hidden block in RTL container with horizontal padding")
{
	verify(document.getElementById('elm').offsetLeft == 50);
	verify(document.getElementById('elm').offsetWidth == 400);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="height:100px;"></div>
	//!  <div style="overflow:hidden; width:10em;">
	//!   <div style="margin-top:-50px;">
	//!    <div style="float:left; width:10px; height:10px;"></div>
	//!   </div>
	//!   <div id="elm1" style="display:inline-block;">x</div>
	//!   <div id="elm2" style="display:inline-block;">x</div>
	//!  </div>
	//! </body></html>
}
test("line above the top of the BFC")
{
	verify(document.getElementById('elm1').offsetTop == 50);
	verify(document.getElementById('elm2').offsetTop == 50);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:500px;">
	//!   <div style="float:left; width:400px; height:50px;"></div>
	//!   <div style="float:left; width:150px; height:50px;"></div>
	//!   <div id="elm" style="overflow:hidden; min-width:200px;">
	//!    <div style="display:inline-block; width:200px; height:10px;"></div>&#x200b;<div id="elm" style="display:inline-block; width:200px; height:10px;"></div>&#x200b;<div id="elm" style="display:inline-block; width:100px; height:10px;"></div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("BFC-block with auto width but min-width beside float")
{
	verify(document.getElementById('elm').offsetTop == 50);
	verify(document.getElementById('elm').offsetLeft == 150);
	verify(document.getElementById('elm').offsetWidth == 350);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:500px;">
	//!   <div style="float:left; width:400px; height:50px;"></div>
	//!   <div style="float:left; width:150px; height:50px;"></div>
	//!   <div id="elm" style="display:table; min-width:200px;">
	//!    <div style="display:inline-block; width:200px; height:10px;"></div>&#x200b;<div id="elm" style="display:inline-block; width:200px; height:10px;"></div>&#x200b;<div id="elm" style="display:inline-block; width:100px; height:10px;"></div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("Table with auto width but min-width beside float")
{
	verify(document.getElementById('elm').offsetTop == 50);
	verify(document.getElementById('elm').offsetLeft == 150);
	verify(document.getElementById('elm').offsetWidth == 350);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:500px;">
	//!  <div style="height:200px;"></div>
	//!  <div id="fl1" style="float:left; width:100px; height:100px;"></div>
	//!  <div id="fl2" style="float:left; width:100%; height:100px;"></div>
	//!  <div style="line-height:100px;">
	//!   <span id="ib1" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib2" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib3" style="display:inline-block; width:50px; height:50px;"></span>
	//!  </div>
	//! </body></html>
}
test("Block before floats, line above last float (L+L)")
{
	verify(ib1.offsetLeft == 100);
	verify(ib1.offsetTop == ib2.offsetTop);
	verify(ib2.offsetTop == ib3.offsetTop);
	verify(fl2.offsetTop == fl1.offsetTop + 100);
	verify(ib1.offsetTop < fl2.offsetTop);
	verify(ib1.offsetTop >= fl1.offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:500px;">
	//!  <div style="height:200px;"></div>
	//!  <div id="fl1" style="float:left; width:100px; height:100px;"></div>
	//!  <div id="fl2" style="float:right; width:100%; height:100px;"></div>
	//!  <div style="line-height:100px;">
	//!   <span id="ib1" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib2" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib3" style="display:inline-block; width:50px; height:50px;"></span>
	//!  </div>
	//! </body></html>
}
test("Block before floats, line above last float (L+R)")
{
	verify(ib1.offsetLeft == 100);
	verify(ib1.offsetTop == ib2.offsetTop);
	verify(ib2.offsetTop == ib3.offsetTop);
	verify(fl2.offsetTop == fl1.offsetTop + 100);
	verify(ib1.offsetTop < fl2.offsetTop);
	verify(ib1.offsetTop >= fl1.offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:500px;">
	//!  <div style="height:200px;"></div>
	//!  <div id="fl1" style="float:right; width:100px; height:100px;"></div>
	//!  <div id="fl2" style="float:left; width:100%; height:100px;"></div>
	//!  <div style="line-height:100px;">
	//!   <span id="ib1" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib2" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib3" style="display:inline-block; width:50px; height:50px;"></span>
	//!  </div>
	//! </body></html>
}
test("Block before floats, line above last float (R+L)")
{
	verify(ib1.offsetLeft == 0);
	verify(ib1.offsetTop == ib2.offsetTop);
	verify(ib2.offsetTop == ib3.offsetTop);
	verify(fl2.offsetTop == fl1.offsetTop + 100);
	verify(ib1.offsetTop < fl2.offsetTop);
	verify(ib1.offsetTop >= fl1.offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:500px;">
	//!  <div style="height:200px;"></div>
	//!  <div id="fl1" style="float:right; width:100px; height:100px;"></div>
	//!  <div id="fl2" style="float:right; width:100%; height:100px;"></div>
	//!  <div style="line-height:100px;">
	//!   <span id="ib1" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib2" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib3" style="display:inline-block; width:50px; height:50px;"></span>
	//!  </div>
	//! </body></html>
}
test("Block before floats, line above last float (R+R)")
{
	verify(ib1.offsetLeft == 0);
	verify(ib1.offsetTop == ib2.offsetTop);
	verify(ib2.offsetTop == ib3.offsetTop);
	verify(fl2.offsetTop == fl1.offsetTop + 100);
	verify(ib1.offsetTop < fl2.offsetTop);
	verify(ib1.offsetTop >= fl1.offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:500px;">
	//!  <div style="height:200px;"></div>
	//!  <div id="fl1" style="float:left; width:100px; height:100px;"></div>
	//!  <div id="fl2" style="float:left; width:100%; height:100px;"></div>
	//!  <div style="line-height:101px;">
	//!   <span id="ib1" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib2" style="display:inline-block; width:50px; height:50px;"></span>
	//!   <span id="ib3" style="display:inline-block; width:50px; height:50px;"></span>
	//!  </div>
	//! </body></html>
}
test("Block before floats, line below last float")
{
	verify(ib1.offsetLeft == 0);
	verify(ib1.offsetTop == ib2.offsetTop);
	verify(ib2.offsetTop == ib3.offsetTop);
	verify(fl2.offsetTop == fl1.offsetTop + 100);
	verify(ib1.offsetTop > fl2.offsetTop + fl2.offsetHeight);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:20em;">
	//!  <div style="height:20em;"></div>
	//!  <div id="fl" style="float:left; width:10em; height:10em;"></div>
	//!  <div style="line-height:10em; margin-top:-15em;">
	//!   x <span id="tall" style="line-height:30em;">x</span>
	//!  </div>
	//! </body></html>
}
test("Line above float, getting too tall content")
{
	verify(tall.offsetLeft == fl.offsetLeft + fl.offsetWidth);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//! <div id="elm" style="font-size:100px;">
	//!  <div style="height:10px;"></div>
	//!  <span style="display:inline-block; width:0;"></span><span style="font-size:10px; width:100px;">x</span>
	//! </div>
	//! <script>
	//! var old_height = document.getElementById('elm').offsetHeight;
	//! document.getElementById('elm').style.fontSize = '10px';
	//! </script>
	//! </body></html>
}
test("Inline-block with zero width but large font-size")
{
	verify(document.getElementById('elm').offsetHeight < old_height);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//! <div></div>
	//! <span style="display:inline-block; width:0;"></span>
	//! <div id="elm"></div>
	//! </body></html>
}
test("Inline-block with zero width after block")
{
	verify(document.getElementById('elm').offsetTop > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; font-size:20px;">
	//! <div></div>
	//! <span style="display:inline-block; width:1px; height:1px;"></span>
	//! <div id="elm" style="position:relative;"></div>
	//! </body></html>
}
test("Small inline-block between blocks, the latter positioned")
{
	verify(document.getElementById('elm').offsetTop > 10); // the line with the inline-block should have full height
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="test">
	//!   <pre>
	//!    <span></span>
	//!    hest
	//!   </pre>
	//!  </div>
	//!  <div id="ref">
	//!   <pre>
	//!
	//!    hest
	//!  </pre>
	//!  </div>
	//! </body></html>
}
test("Empty inline on line, in PRE")
{
	verify(document.getElementById('test').offsetHeight == document.getElementById('ref').offsetHeight);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="test">
	//!   <div style="display:inline-block; vertical-align:10em; width:100px; height:2em;"></div>
	//!  </div>
	//!  <div id="ref">
	//!   <div style="display:inline-block; vertical-align:10em; width:100px; height:2em;"></div> text
	//!  </div>
	//! </body></html>
}
test("Line content descender shorter than strut descender")
{
	verify(document.getElementById('test').offsetHeight == document.getElementById('ref').offsetHeight);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <span></span>
	//!  <div style="float:left; position:relative; width:0;"></div>
	//!  <span style="vertical-align:top;">&nbsp;</span>
	//!  <div id="elm" style="position:absolute; width:100px; height:100px;"></div>
	//! </body></html>
}
test("Empty inline, positioned float, top-aligned word, abspos")
disabled; /* This was introduced by the fix for CORE-25463, and it's not fixed
			 by CORE-30469 either. However, it would have been fixed, had it
			 not been for bug CORE-33072 (which is an old bug). */
{
	verify(document.getElementById('elm').offsetTop > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <span style="vertical-align:top; font-size:10em;">&nbsp;</span>
	//!  <div id="elm" style="position:absolute; width:100px; height:100px;"></div>
	//!  <span style="font-size:10em;">&nbsp;</span>
	//!  <div id="ref" style="width:100px; height:100px;"></div>
	//! </body></html>
}
test("Tall top-aligned word, abspos")
disabled; // See bug CORE-33072
{
	verify(document.getElementById('elm').offsetTop == document.getElementById('ref').offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <span>&nbsp;</span>
	//!  <span style="vertical-align:top; font-size:10em;">&nbsp;</span>
	//!  <div id="elm" style="position:absolute; width:100px; height:100px;"></div>
	//!  <span style="font-size:10em;">&nbsp;</span>
	//!  <div id="ref" style="width:100px; height:100px;"></div>
	//! </body></html>
}
test("Word, tall top-aligned word, abspos")
disabled; // See bug CORE-33072
{
	verify(document.getElementById('elm').offsetTop == document.getElementById('ref').offsetTop);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="height:7%; margin-bottom:100px;"></div>
	//!  <div id="elm" style="height:10px;"></div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm').style.width = '100px';
	//!  </script>
	//! </body></html>
}
test("% height resolved to auto, with bottom margin")
{
	// This test is inspired by ACID2 ("empty" and "smile" lines).

	verify(document.getElementById('elm').offsetTop == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of block container")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="float:left; width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of floating container")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="position:absolute; width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of abspos container")
{
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="display:table; width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of block table")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="display:table; float:left; width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of floating table")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <div id="elm2" style="display:table; position:absolute; width:100px; height:100px; margin:10px 0;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of abspos table")
{
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <img id="elm2" style="display:block; width:100px; height:100px; margin:10px 0;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0AQMAAADxGE3JAAAAAXNSR0IArs4c6QAAAANQTFRF%2F%2F%2F%2Fp8QbyAAAADVJREFUeNrtwTEBAAAAwqD1T%2B1hDaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbn0AAAGDIqjNAAAAAElFTkSuQmCC">
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of block image")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <img id="elm2" style="float:left; width:100px; height:100px; margin:10px 0;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0AQMAAADxGE3JAAAAAXNSR0IArs4c6QAAAANQTFRF%2F%2F%2F%2Fp8QbyAAAADVJREFUeNrtwTEBAAAAwqD1T%2B1hDaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbn0AAAGDIqjNAAAAAElFTkSuQmCC">
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of floating image")
{
	verify(document.getElementById('elm1').offsetHeight == 120);
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm1" style="overflow:hidden; width:400px;">
	//!   <img id="elm2" style="position:absolute; width:100px; height:100px; margin:10px 0;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0AQMAAADxGE3JAAAAAXNSR0IArs4c6QAAAANQTFRF%2F%2F%2F%2Fp8QbyAAAADVJREFUeNrtwTEBAAAAwqD1T%2B1hDaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbn0AAAGDIqjNAAAAAElFTkSuQmCC">
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm1').style.width = '300px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of abspos image")
{
	verify(document.getElementById('elm2').offsetHeight == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div>
	//!   <div style="height:1px; margin-bottom:40px;"></div>
	//!  </div>
	//!  <div id="elm" style="width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft;
	//!   document.getElementById('elm').style.width = '101px';
	//!  </script>
	//! </body></html>
}
test("Skip reflow of container with child with bottom margin")
{
	verify(document.getElementById('elm').offsetTop == 41);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div style="width:300px; font-size:16px; line-height:30px;">
	//!   &nbsp;
	//!   <div style="float:left; width:300px; height:50px;"></div>
	//!   <div></div>
	//!   <div id="elm" style="float:left; width:300px; height:50px;"></div>
	//!  </div>
	//! </body></html>
}
test("Adding float after pushing another one below the current line")
{
	verify(document.getElementById('elm').offsetTop == 80);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;"></div>
	//! </body></html>
}
test("overflow:auto, Empty, fixed-size #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 100);
	verify(document.getElementById('elm').scrollHeight == 100);
}
test("overflow:auto, Empty, fixed-size #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:10px; height:10px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, content that fits #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 100);
	verify(document.getElementById('elm').scrollHeight == 100);
}
test("overflow:auto, content that fits #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, content that barely fits #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 100);
	verify(document.getElementById('elm').scrollHeight == 100);
}
test("overflow:auto, content that barely fits #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, too wide content #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 1);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight < 100);
	verify(document.getElementById('elm').scrollHeight > 10);
}
test("overflow:auto, too wide content #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, too tall content #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 1);
	verify(document.getElementById('elm').scrollWidth < 100);
	verify(document.getElementById('elm').scrollWidth > 10);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow:auto, too tall content #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, too wide causing too tall content #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 1);
	verify(document.getElementById('elm').scrollTop > 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 99);
}
test("overflow:auto, too wide causing too tall content #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:auto, too tall causing too wide content #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 0);
	verify(document.getElementById('elm').scrollTop > 1);
	verify(document.getElementById('elm').scrollWidth == 99);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow:auto, too tall causing too wide content #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:auto; overflow-y:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:auto, overflow-y:hidden, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 1);
	verify(document.getElementById('elm').scrollTop > 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 99);
}
test("overflow-x:auto, overflow-y:hidden, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:hidden; overflow-y:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:hidden, overflow-y:auto, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 1);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 100);
}
test("overflow-x:hidden, overflow-y:auto, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:auto; overflow-y:hidden; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:auto, overflow-y:hidden, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 1);
	verify(document.getElementById('elm').scrollWidth == 100);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:auto, overflow-y:hidden, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:hidden; overflow-y:auto; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:hidden, overflow-y:auto, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 0);
	verify(document.getElementById('elm').scrollTop == 1);
	verify(document.getElementById('elm').scrollWidth == 99);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:hidden, overflow-y:auto, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:auto; overflow-y:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:auto, overflow-y:scroll, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 1);
	verify(document.getElementById('elm').scrollTop > 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 99);
}
test("overflow-x:auto, overflow-y:scroll, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:scroll; overflow-y:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:scroll, overflow-y:auto, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 1);
	verify(document.getElementById('elm').scrollTop > 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 99);
}
test("overflow-x:scroll, overflow-y:auto, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:auto; overflow-y:scroll; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:auto, overflow-y:scroll, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 0);
	verify(document.getElementById('elm').scrollTop > 1);
	verify(document.getElementById('elm').scrollWidth == 99);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:auto, overflow-y:scroll, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:scroll; overflow-y:auto; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:scroll, overflow-y:auto, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 0);
	verify(document.getElementById('elm').scrollTop > 1);
	verify(document.getElementById('elm').scrollWidth == 99);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:scroll, overflow-y:auto, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:scroll; overflow-y:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:scroll, overflow-y:hidden, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 1);
	verify(document.getElementById('elm').scrollTop > 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 99);
}
test("overflow-x:scroll, overflow-y:hidden, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:hidden; overflow-y:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:99px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:hidden, overflow-y:scroll, too wide #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 1);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 101);
	verify(document.getElementById('elm').scrollHeight == 100);
}
test("overflow-x:hidden, overflow-y:scroll, too wide #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:scroll; overflow-y:hidden; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:scroll, overflow-y:hidden, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop > 1);
	verify(document.getElementById('elm').scrollWidth == 100);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:scroll, overflow-y:hidden, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow-x:hidden; overflow-y:scroll; width:100px; height:100px;">
	//!   <div style="width:99px; height:101px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow-x:hidden, overflow-y:scroll, too tall #1")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft > 0);
	verify(document.getElementById('elm').scrollTop == 1);
	verify(document.getElementById('elm').scrollWidth == 99);
	verify(document.getElementById('elm').scrollHeight == 101);
}
test("overflow-x:hidden, overflow-y:scroll, too tall #2")
language C++;
{
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
	verify(box->GetWidth() == 100);
	verify(box->GetHeight() == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '101px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, add horizontal scrollbar")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.height = '101px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, add vertical scrollbar")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:10px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '101px';
	//!   document.getElementById('inner').style.height = '101px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, add both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:10px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '101px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, increase width to add both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:100px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.height = '101px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, increase height to add both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '10px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, remove horizontal scrollbar")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.height = '10px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, remove vertical scrollbar")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '10px';
	//!   document.getElementById('inner').style.height = '10px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, remove both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.width = '10px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, reduce width to remove both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div id="inner" style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('inner').style.height = '10px';
	//!  </script>
	//! </body></html>
}
test("overflow:auto, reduce height to remove both scrollbars")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:1000px; height:500px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:hidden, scroll")
{
	document.getElementById('elm').scrollLeft = 1000;
	document.getElementById('elm').scrollTop = 1000;
	verify(document.getElementById('elm').scrollLeft == 900);
	verify(document.getElementById('elm').scrollTop == 400);
	verify(document.getElementById('elm').scrollWidth == 1000);
	verify(document.getElementById('elm').scrollHeight == 500);
	document.getElementById('elm').scrollLeft = 0;
	document.getElementById('elm').scrollTop = 0;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:1000px; height:500px;"></div>
	//!  </div>
	//! </body></html>
}
test("overflow:hidden, scroll, negative position")
{
	document.getElementById('elm').scrollLeft = -1000;
	document.getElementById('elm').scrollTop = -1000;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
	verify(document.getElementById('elm').scrollWidth == 1000);
	verify(document.getElementById('elm').scrollHeight == 500);
	document.getElementById('elm').scrollLeft = 0;
	document.getElementById('elm').scrollTop = 0;
	verify(document.getElementById('elm').scrollLeft == 0);
	verify(document.getElementById('elm').scrollTop == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:auto, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:scroll; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:scroll -> overflow:hidden, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'auto';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:auto, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:hidden; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:hidden -> overflow:scroll, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'hidden';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:hidden, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() == 0);
	verify(sc->GetHorizontalScrollbarWidth() == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;"></div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, no overflow (empty)")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, no overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:10px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:10px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, v overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, v+h overflow")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:100px; height:101px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, h overflow caused by v")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body>
	//!  <div id="elm" style="overflow:auto; width:100px; height:100px;">
	//!   <div style="width:101px; height:100px;"></div>
	//!  </div>
	//!  <script>
	//!   document.body.offsetLeft; // force reflow.
	//!   document.getElementById('elm').style.overflow = 'scroll';
	//!  </script>
	//! </body></html>
}
test("overflow:auto -> overflow:scroll, v overflow caused by h")
language C++;
{
	verify(OpStatus::IsSuccess(state.doc->Reflow(FALSE)));
	HTML_Element* elm = state.doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());

	Box* box = elm->GetLayoutBox();
	ScrollableArea* sc = box->GetScrollable();
	verify(sc);

	verify(sc->GetVerticalScrollbarWidth() > 0);
	verify(sc->GetHorizontalScrollbarWidth() > 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; font-size:1000px;">
	//!   <div id="elm" style="font-size:0.01em; height: 1em"></div>
	//! </body></html>
}

test("Relative font size calculation 1")
{
	verify(document.getElementById('elm').offsetHeight == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; font-size:0.01px;">
	//!   <div id="elm" style="font-size:1000em; height: 1em"></div>
	//! </body></html>
}

test("Relative font size calculation 2")
{
	verify(document.getElementById('elm').offsetHeight == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; font-size:16px;">
	//!   <div id="elm" style="font-size:16em; height: 1em"></div>
	//! </body></html>
}

test("Relative font size calculation 3")
{

	verify(document.getElementById('elm').offsetHeight == 256);
}

html
{
	//! <html><body style="margin:0;">
	//!  <span>
	//!   <span style="position: absolute;"></span>
	//!   <img src="" style="display: inline-block; vertical-align: top; width: 100px; height: 100px;">
	//!  </span>
	//!  <div id="testme"></div>
	//! </body></html>
}

test("Line height (inline block follows abs-pos element)")
{
	verify(document.getElementById('testme').offsetTop == 100);
}

html
{
		//! <!DOCTYPE html>
		//! <html>
		//!  <body style="margin:0;">
		//!   <div id="elm">
		//!    <div style="float:left; width:100px; height:100px;"></div>
		//!    <div style="clear:left;"></div>
		//!    &nbsp;
		//!    <div style="margin-bottom:50px;"></div>
		//!   </div>
		//!   <div id="ref">
		//!    <div style="float:left; width:100px; height:100px;"></div>
		//!    <div style="height:100px;"></div>
		//!    &nbsp;
		//!    <div style="margin-bottom:50px;"></div>
		//!   </div>
		//!  </body>
		//! </html>
}
test("Margin following clearance and inline content")
{
	verify(document.getElementById('elm').offsetHeight == document.getElementById('ref').offsetHeight);
}

html
{
		//! <!DOCTYPE html>
		//! <html>
		//!  <body style="margin:0;">
		//!   <div id="elm">
		//!    <div style="float:left; width:100px; height:100px;"></div>
		//!    <div style="clear:left;"></div>
		//!    <div style="height:1px;"></div>
		//!    <div style="margin-bottom:50px;"></div>
		//!   </div>
		//!   <div id="ref">
		//!    <div style="float:left; width:100px; height:100px;"></div>
		//!    <div style="height:100px;"></div>
		//!    <div style="height:1px;"></div>
		//!    <div style="margin-bottom:50px;"></div>
		//!   </div>
		//!  </body>
		//! </html>
}
test("Margin following clearance and block")
{
	verify(document.getElementById('elm').offsetHeight == document.getElementById('ref').offsetHeight);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0; font-size:16px;">
	//!   <div style="float:left; width:100%; height:10px;"></div>
	//!   <div style="clear:left; margin-bottom:-100px;"></div>
	//!   <div id="elm" style="clear:left;"></div>
	//!  </body>
	//! </html>
}
test("Block clearance through float, after negative bottom margin")
// Inspired by CORE-28534
{
	verify(document.getElementById('elm').offsetTop == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0; font-size:16px;">
	//!   <div style="float:left; width:100%; height:10px;"></div>
	//!   <div style="clear:left; margin-top:-100px;"></div>
	//!   <div id="elm" style="clear:left;"></div>
	//!  </body>
	//! </html>
}
test("Block clearance through float, after negative top margin")
{
	verify(document.getElementById('elm').offsetTop == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0; font-size:16px;">
	//!   <div style="float:left; width:100%; height:10px;"></div>
	//!   <div style="clear:left;"></div>
	//!   <div id="elm" style="clear:left; margin-top:-100px;"></div>
	//!  </body>
	//! </html>
}
test("Block clearance through float, negative top margin")
{
	verify(document.getElementById('elm').offsetTop == 10);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0; line-height:50px;">
	//!   <div style="float:left; width:10px; height:10px;"></div>
	//!   <br>
	//!   <div style="margin-top:100px;">
	//!    <div id="elm" style="clear:left; margin-top:100px;"></div>
	//!   </div>
	//!  </body>
	//! </html>
}
test("No clearance, no content")
{
	verify(document.getElementById('elm').offsetTop == 150);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0; width:0; line-height:1em;">
	//!   &nbsp;
	//!   <div id="elm" style="float:left; position:relative; top:-1em;">&nbsp;</div>
	//! </body></html>
}
test("Positioned float pushed below current line") // inspired by bug CORE-31420
{
	verify(document.getElementById('elm').offsetTop == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="elm" style="height:50%;"></div>
	//! </body></html>
}
test("%-height block in auto-height body")
{
	verify(document.getElementById('elm').offsetHeight == 0);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <img id="elm" style="height:50%;" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////ywAAAAAAQABAAACAkQBADs=">
	//! </body></html>
}
test("%-height image in auto-height body")
{
	verify(document.getElementById('elm').offsetHeight == 1);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <table id="elm" style="height:50%;" cellspacing="2" cellpadding="1"><tr><td></td></tr></table>
	//! </body></html>
}
test("%-height table in auto-height body")
{
	verify(document.getElementById('elm').offsetHeight == 6);
}

html
{
	//! <!DOCTYPE html>
	//! <html style="height:100%;"><body style="margin:0; height:100%;">
	//!  <div style="height:50%;">
	//!   <div id="elm" style="height:50%;"></div>
	//!  </div>
	//! </body></html>
}
test("%-height block in %-height ancestors")
language c++;
{
	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 4);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 500);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 125);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 4));
}

html
{
	//! <!DOCTYPE html>
	//! <html style="height:100%;"><body style="margin:0; height:100%;">
	//!  <div style="display:table; height:50%;">
	//!   <div style="display:table-row;">
	//!    <div id="elm" style="display:table-cell; height:50%;">&nbsp;</div>
	//!   </div>
	//!   <div style="display:table-row;">
	//!    <div style="display:table-cell;">&nbsp;</div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("%-height table-cell in %-height ancestors")
language c++;
{
	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 4);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 500);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 125);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 4));
}

html
{
	//! <html><body style="margin:0;">
	//!   <div id="elm" style="height:50%;"></div>
	//! </body></html>
}
test("quirk: %-height block in auto-height body")
language c++;
{
	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 2);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 1000);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 250);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 2));
}

html
{
	//! <html><body style="margin:0;overflow:hidden">
	//!  <div>
	//!   <div style="height:100%;">
	//!    <img id="elm" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////ywAAAAAAQABAAACAkQBADs=" style="height:50%;">
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("quirk: %-height image in %-height container in auto-height")
language c++;
{
	/* Note: our implementation is currently buggy, in that it assumes that any
	   percentual-height containers that it has to pass in the quest of resolving the
	   height for the image have height:100%. */

	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 2);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 1000);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 250);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 2));
}

html
{
	//! <html><body style="margin:0;">
	//!  <div>
	//!   <div style="height:100%;">
	//!    <table id="elm" style="height:50%;"><tr><td></td></tr></table>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("quirk: %-height table in %-height container in auto-height")
language c++;
{
	/* Note: our implementation is currently buggy, in that it assumes that any
	   percentual-height containers that it has to pass in the quest of resolving the
	   height for the table have height:100%. */

	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 2);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 1000);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 250);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 2));
}

html
{
	//! <html><body style="margin:0;">
	//!  <div>
	//!   <div style="height:100%;">
	//!    <div id="elm" style="position:relative; height:50%;"></div>
	//!   </div>
	//!  </div>
	//! </body></html>
}
test("quirk: %-height relpos in %-height container in auto-height")
language c++;
{
	/* Note: our implementation is currently buggy, in that it assumes that any
	   percentual-height containers that it has to pass in the quest of resolving the
	   height for the relatively positioned element have height:100%. */

	FramesDocument* doc = state.doc;
	Window* win = doc->GetWindow();
	UINT32 orig_width, orig_height;
	GetWindowSize(win, orig_width, orig_height);

	HTML_Element* elm = doc->GetDocRoot()->GetElmById(UNI_L("elm"));
	verify(elm);
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == doc->GetLayoutViewHeight() / 2);

	// Increase window height.

	verify(SetWindowSize(win, orig_width, 2000));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 1000);

	// Decrease window height.

	verify(SetWindowSize(win, orig_width, 500));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == 250);

	// Back to original window size.

	verify(SetWindowSize(win, orig_width, orig_height));
	verify(elm->GetLayoutBox());
	verify(elm->GetLayoutBox()->GetHeight() == (long)(orig_height / 2));
}

html
{
	//! <html>
	//!  <head><script> window.onload = function() { document.getElementById('elm').style.top = '10px'; } </script> </head>
	//!  <body style="margin:0;">
	//!   <div>
	//!    <div style="height: 20px; margin-bottom: 20px; background: navy;"></div>
	//!    <div style="display: block; font-size: 0; line-height: 0; height: 0;"></div>
	//!   </div>
	//!   <div style="background: navy; height:20px;" id="elm"></div>
	//!  </body>
	//! </html>
}

test("Collapse margins through element with height set to 0")
{
	verify(document.getElementById('elm').offsetTop == 40);
}

html
{
	//! <html>
	//!  <head><script> window.onload = function() { document.getElementById('elm').style.top = '10px'; } </script> </head>
	//!  <body style="margin:0;">
	//!    <div style="margin-top: 20px; margin-bottom: 10px; min-height: 10px; background-color: lime"></div>
	//!    <div style="background: navy; height:20px;" id="elm"></div>
	//! </body>
	//! </html>
}

test("Don't collapse margins of element with min-height")
{
	verify(document.getElementById('elm').offsetTop == 40);
}

html
{
	//! <html>
	//!  <head><script> window.onload = function() { document.getElementById('elm').style.top = '10px'; } </script> </head>
	//!  <body style="margin:0;">
	//!   <div style="min-height: 10px; background-color:lime;">
	//!    <div style="margin-bottom: 20px; height: 50px;"></div>
	//!   </div>
	//!    <div style="background: navy; height:20px;" id="elm"></div>
	//! </body>
	//! </html>
}

test("Collapse child & parent bottom margins, parent has min-height")
{
	verify(document.getElementById('elm').offsetTop == 70);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0;">
	//!   <div style="margin-top: 100px; margin-bottom: 100px; padding-left: 1px; border-right: 1px solid black;"></div>
	//!   <div id="testme"></div>
	//! </body>
	//! </html>
}

test("Horizontal paddings & borders do not stop margin collapsing")
{
	verify(document.getElementById('testme').offsetTop == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0;">
	//!   <div style="margin-top: 100px; margin-bottom: 100px; padding-bottom: 1px; border-bottom: 1px solid black;"></div>
	//!   <div id="testme"></div>
	//! </body>
	//! </html>
}

test("Vertical paddings & borders stop margin collapsing")
{
	verify(document.getElementById('testme').offsetTop == 202);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0;">
	//!   <div style="display: inline-block; position: relative; width: 100px; height: 100px;">
	//!    <span>&nbsp;</span><div id="testme" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0;"></div>
	//!   </div>
	//! </body>
	//! </html>
}

test("Inline block box as inline abs-pos containing block")
{
	verify(document.getElementById('testme').offsetWidth == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html>
	//!  <body style="margin:0;">
	//!   <div id="outer" style="width: 200px; height: 100px; overflow:hidden;">
	//!    <div style="float:left; width:1px; height:200px;"></div>
	//!    <div id="table" style="display:table;">
	//!     <div style="width:200px; height:200px;"></div>
	//!    </div>
	//!   </div>
	//! </body>
	//! </html>
}

test("Scroll offset not truncated by layout")
{
	document.body.offsetLeft;
	document.getElementById('outer').scrollTop = 300;
	document.getElementById('table').style.position = "relative";

	verify(document.getElementById('outer').scrollTop == 300);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="outer" style="height: 0; width: 200px; position: relative;">
	//!   <div id="testme" style="top: 0; bottom: 0; position: absolute; width: 200px;"></div>
	//!  </div>
	//! </body></html>
}
test("Positioned child height affected by parent's height change")
{
	document.getElementById('outer').style.height = '20px';

	verify(document.getElementById('testme').offsetHeight == 20);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="outer" style="height: 0; width: 200px; position: relative;">
	//!   <table id="testme" style="top: 0; bottom: 0; position: absolute; width: 200px;"></table>
	//!  </div>
	//! </body></html>
}
test("Positioned table height affected by parent's height change")
{
	document.getElementById('outer').style.height = '20px';

	verify(document.getElementById('testme').offsetHeight == 20);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="outer" style="height: 0; width: 200px; position: relative;">
	//!   <div id="testme" style="top: 0; bottom: 0; position: absolute;"></div>
	//!  </div>
	//! </body></html>
}
test("Positioned STF height affected by parent's height change")
{
	document.getElementById('outer').style.height = '20px';

	verify(document.getElementById('testme').offsetHeight == 20);
}

html
{
//! <!DOCTYPE html>
//! <html>
//!  <body style="margin:0;">
//!   <div style="height: 100px; width: 150px; float: left; background: lime;"></div>
//!   <div id="testme" style="height: 100px; width: 150px; display: inline; position: absolute; border: 1px solid pink;"></div>
//!  </body>
//! </html>
}
test("Positioned inline next to float")
{
	verify(document.getElementById('testme').offsetLeft == 150);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <div id="outer" style="width: 200px; height: 100px; overflow:hidden;">
	//!   <div style="float:left; width:1px; height:200px;"></div>
	//!   <div id="table" style="display:table;">
	//!    <div style="width:200px; height:200px;"></div>
	//!   </div>
	//!  </div>
	//! </body></html>
}

test("Saving current scroll pos during reflow/recreate")
{
	document.getElementById('outer').scrollTop = 300;
	document.body.dir = document.body.dir;

	verify(document.getElementById('outer').scrollTop == 300);

	document.getElementById('outer').scrollTop = 100;
	document.getElementById('table').style.position = 'relative';

	verify(document.getElementById('outer').scrollTop == 100);
}

html
{
	//! <!DOCTYPE html>
	//! <html><body style="margin:0;">
	//!  <table id="testme" style="border:0; padding:0; border-spacing: 0px;"><tr><td style="padding: 0; vertical-align: baseline;">
	//!   <div style="float:left; height: 20px; width: 20px; font-size: 100px;">XXX</div>
	//!  </td></tr></table>
	//! </body></html>
}

test("Baseline for floats")
{
	verify(document.getElementById('testme').offsetHeight == 20);
}

html
{
//!<!DOCTYPE HTML>
//!<html>
//!<style>
//!	#abs {position:absolute;background:lime;}
//!	div > div {min-width:100px;overflow:auto;height:100px;}
//!</style>
//!<body>
//!<div id="abs">
//!	<div></div>
//!</div>
//!</body>
//!</html>
}
test ("ScrollableContainer with min-width being a child of abs pos")
	/* CORE-40140: The test is about the fact that ScrollableContainer, which
	   inherits from ShrinkToFitContainer, sometimes is in fact not one and
	   should ignore ShrinkToFitContainer behavior. */
{
	verify(document.getElementById('abs').offsetWidth == 100);
}

html
{
	//! <!DOCTYPE HTML>
	//! <html><body>
	//!   <div id="sc" style="overflow:auto; width:500px; height:500px; line-height:100px;">
	//!    <br><br><br><br><br><br>
	//!   </div>
	//! </body></html>
}
test("overflow:auto, BR causing scrollbar")
{
	verify(document.getElementById('sc').scrollHeight == 600);
	verify(document.getElementById('sc').scrollWidth < 500);
}

html
{
	//! <!DOCTYPE HTML>
	//! <html><body>
	//!   <div id="sc" style="overflow:auto; width:500px; height:500px; line-height:100px;">
	//!    <div style="margin-top:480px;"></div>
	//!    <br>
	//!   </div>
	//! </body></html>
}
test("overflow:auto, BR with preceding margin")
{
	verify(document.getElementById('sc').scrollHeight == 580);
	verify(document.getElementById('sc').scrollWidth < 500);
}

html
{
	//! <!DOCTYPE HTML>
	//! <html><body>
	//!   <div id="sc" style="overflow:auto; width:500px; height:500px; line-height:100px;">
	//!    <div style="float:left; width:30px; height:500px;"></div>
	//!    <br style="clear:both;">
	//!   </div>
	//! </body></html>
}
test("overflow:auto, BR with clearance")
{
	/* The bottom of the BR will be flush with that of the float, so no need
	   for scrollbars. */

	verify(document.getElementById('sc').scrollHeight == 500);
	verify(document.getElementById('sc').scrollWidth == 500);
}

html
{
    //! <html><body style="width:100px;height:100px;"></body></html>
}

test("document.body.offsetWidth in quirks mode")
language ecmascript;
{
    verify(document.body.offsetWidth == 100);
    verify(document.body.offsetHeight == 100);
}

html
{
//!<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
//!<html>
//!<head>
//!
//!<style type="text/css">
//!
//! * {margin:0;padding:0;}
//!
//!body
//!{
//!	width:10000px;
//!	height:10000px;
//!}
//!
//!input
//!{
//!	width:0.25%;
//!	height:0.14%;
//! border:none;
//!}
//!
//!#float
//!{
//!	float:left;
//!	width:1.32%;
//!	height:20px;
//!}
//!
//!#block
//!{
//!	width:20px;
//!	height:14.58%;
//!}
//!
//!</style>
//!
//!</head>
//!<body>
//!
//!<input type="text" />
//!
//!<div id="float">
//!</div>
//!
//!<div id="block">
//!</div>
//!
//!</body>
//!</html>
}
test("Fraction percentage width/height precision")
{
	verify(document.getElementsByTagName('input')[0].offsetWidth == 25);
	verify(document.getElementsByTagName('input')[0].offsetHeight == 14);

	verify(document.getElementById('float').offsetWidth == 132);
	verify(document.getElementById('block').offsetHeight == 1458);
}
